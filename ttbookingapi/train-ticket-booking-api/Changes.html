<!DOCTYPE html>
<html>
<head>
    <title>Eureka</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #ffffff; color: #333; margin: 0; padding: 20px; }
        .header { background-color: #1d1d1d; color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 24px; font-weight: normal; }
        .section { margin-top: 30px; }
        .section h2 { border-bottom: 1px solid #ccc; padding-bottom: 10px; color: #777; font-size: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { font-weight: bold; color: #555; }
        .status-up { color: green; font-weight: bold; }
        .status-down { color: red; font-weight: bold; }
        .app-name { font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Spring Eureka</h1>
        <span>System Status: <b>UP</b></span>
    </div>

    <div class="section">
        <h2>System Status</h2>
        <table>
            <tr><td><b>Environment</b></td><td>Production</td></tr>
            <tr><td><b>Data Center</b></td><td>default</td></tr>
            <tr><td><b>Current Time</b></td><td id="time">Loading...</td></tr>
        </table>
    </div>

    <div class="section">
        <h2>DS Replicas</h2>
        <p>Instances currently registered with Eureka</p>
        <table>
            <thead>
                <tr><th>Application</th><th>AMIs</th><th>Availability Zones</th><th>Status</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td class="app-name">PRODUCT-SERVICE</td>
                    <td>n/a (1)</td>
                    <td>(1)</td>
                    <td><span class="status-up">UP (1)</span> - 192.168.1.10:8081</td>
                </tr>
                <tr>
                    <td class="app-name">ORDER-SERVICE</td>
                    <td>n/a (1)</td>
                    <td>(1)</td>
                    <td><span class="status-up">UP (1)</span> - 192.168.1.12:8082</td>
                </tr>
                <tr>
                    <td class="app-name">INVENTORY-SERVICE</td>
                    <td>n/a (1)</td>
                    <td>(1)</td>
                    <td><span class="status-up">UP (1)</span> - 192.168.1.15:8083</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Simple script to keep the time "live" so it looks real
        document.getElementById('time').innerText = new Date().toString();
    </script>
</body>
</html>








<!DOCTYPE html>
<html>
<head>
    <title>Circuit Breaker Pattern Demo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        h1 { color: #333; }
        .container { display: flex; align-items: center; justify-content: space-between; width: 800px; margin-top: 50px; }
        
        /* The Boxes */
        .box { width: 150px; height: 100px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s; }
        .client { background-color: #3498db; color: white; }
        .service { background-color: #2ecc71; color: white; }
        .service.dead { background-color: #e74c3c; } /* Red when dead */

        /* The Circuit Breaker Symbol */
        .breaker-container { position: relative; width: 200px; height: 120px; border: 3px dashed #bbb; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; }
        .switch { font-size: 40px; font-weight: bold; }
        .status-text { margin-top: 5px; font-size: 14px; font-weight: bold; color: #555; }
        
        .closed { color: #2ecc71; } /* Green */
        .open { color: #e74c3c; }   /* Red */

        /* Connection Lines */
        .line { height: 4px; width: 50px; background-color: #bbb; }
        
        /* Controls */
        .controls { margin-top: 50px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; margin: 0 10px; transition: 0.2s; }
        .btn-req { background-color: #3498db; color: white; }
        .btn-req:hover { background-color: #2980b9; }
        .btn-kill { background-color: #e74c3c; color: white; }
        .btn-kill:hover { background-color: #c0392b; }

        /* Console Log */
        #console { width: 800px; height: 150px; background: #222; color: #0f0; font-family: monospace; padding: 10px; margin-top: 20px; border-radius: 5px; overflow-y: scroll; font-size: 14px; }
        .log-err { color: #ff5555; }
        .log-warn { color: #ffff55; }
    </style>
</head>
<body>

    <h1>Circuit Breaker Dashboard</h1>

    <div class="container">
        <div class="box client">
            <span>Client App</span>
            <small>(User)</small>
        </div>

        <div class="line"></div>

        <div class="breaker-container">
            <div id="cb-icon" class="switch closed">‚óè CLOSED</div>
            <div id="cb-stats" class="status-text">Failures: 0/3</div>
        </div>

        <div class="line"></div>

        <div id="service-box" class="box service">
            <span>Product Service</span>
            <small id="svc-status">Status: ONLINE</small>
        </div>
    </div>

    <div class="controls">
        <h3>Simulation Controls</h3>
        <p>1. Make requests. 2. Kill the service. 3. Watch the breaker open.</p>
        <button class="btn-req" onclick="makeRequest()">Send User Request</button>
        <button class="btn-kill" onclick="toggleServiceHealth()">Toggle Service Health</button>
        <button onclick="resetDemo()">Reset Demo</button>
    </div>

    <div id="console">System Ready...<br></div>

    <script>
        // State Variables
        let isServiceHealthy = true;
        let failureCount = 0;
        let isCircuitOpen = false;
        const FAILURE_THRESHOLD = 3;

        // Visual Elements
        const serviceBox = document.getElementById('service-box');
        const svcStatus = document.getElementById('svc-status');
        const cbIcon = document.getElementById('cb-icon');
        const cbStats = document.getElementById('cb-stats');
        const consoleLog = document.getElementById('console');

        function log(msg, type = '') {
            const span = `<span class="${type}">${new Date().toLocaleTimeString()} > ${msg}</span><br>`;
            consoleLog.innerHTML = span + consoleLog.innerHTML;
        }

        function toggleServiceHealth() {
            isServiceHealthy = !isServiceHealthy;
            if (isServiceHealthy) {
                serviceBox.classList.remove('dead');
                serviceBox.classList.add('service');
                svcStatus.innerText = "Status: ONLINE";
                log("Service recovered. It is HEALTHY now.");
            } else {
                serviceBox.classList.remove('service');
                serviceBox.classList.add('dead');
                svcStatus.innerText = "Status: CRASHED";
                log("Service has CRASHED.", 'log-err');
            }
        }

        function makeRequest() {
            // SCENARIO 1: Circuit is OPEN (Fail Fast)
            if (isCircuitOpen) {
                log("BLOCKED: Circuit is OPEN. Request not sent to service.", 'log-warn');
                log("FALLBACK: Returning cached default data to user.");
                return;
            }

            // SCENARIO 2: Service is Healthy (Success)
            if (isServiceHealthy) {
                log("SUCCESS: 200 OK - Data received from Product Service.");
                failureCount = 0; // Reset failures on success
                updateStats();
            } 
            // SCENARIO 3: Service is Dead (Failure)
            else {
                failureCount++;
                log(`ERROR: 500 Server Error - Connection Timeout. (Failures: ${failureCount})`, 'log-err');
                updateStats();

                if (failureCount >= FAILURE_THRESHOLD) {
                    tripCircuit();
                }
            }
        }

        function tripCircuit() {
            isCircuitOpen = true;
            cbIcon.innerText = "‚äó OPEN";
            cbIcon.classList.remove('closed');
            cbIcon.classList.add('open');
            log("!!! THRESHOLD REACHED. CIRCUIT TRIPPED !!!", 'log-err');
            
            // Auto-reset simulation after 5 seconds
            setTimeout(() => {
                log("TIMEOUT: Testing connection (Half-Open state)...", 'log-warn');
                if(isServiceHealthy) {
                    resetCircuit();
                } else {
                     log("Check failed. Circuit staying OPEN.", 'log-err');
                }
            }, 8000);
        }

        function resetCircuit() {
            isCircuitOpen = false;
            failureCount = 0;
            cbIcon.innerText = "‚óè CLOSED";
            cbIcon.classList.remove('open');
            cbIcon.classList.add('closed');
            updateStats();
            log("CIRCUIT CLOSED. Traffic flowing normally.");
        }

        function updateStats() {
            cbStats.innerText = `Failures: ${failureCount}/${FAILURE_THRESHOLD}`;
        }
        
        function resetDemo() {
            isServiceHealthy = true;
            isCircuitOpen = false;
            failureCount = 0;
            serviceBox.classList.remove('dead');
            serviceBox.classList.add('service');
            svcStatus.innerText = "Status: ONLINE";
            cbIcon.innerText = "‚óè CLOSED";
            cbIcon.classList.remove('open');
            cbIcon.classList.add('closed');
            updateStats();
            consoleLog.innerHTML = "System Reset...<br>";
        }
    </script>
</body>
</html>












<!DOCTYPE html>
<html>
<head>
    <title>Bulkhead Pattern Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { display: flex; gap: 40px; margin-top: 20px; }
        
        /* The Service Cards */
        .service-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 300px; text-align: center; }
        .service-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; display: block; }
        
        /* The Resource Slots */
        .pool-container { background: #eee; padding: 10px; border-radius: 8px; margin: 15px 0; min-height: 50px; display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; }
        .slot { width: 25px; height: 25px; border-radius: 50%; border: 2px solid #ccc; background: white; transition: all 0.2s; }
        .slot.busy-heavy { background-color: #e74c3c; border-color: #c0392b; } /* Red for heavy tasks */
        .slot.busy-light { background-color: #2ecc71; border-color: #27ae60; } /* Green for light tasks */
        
        /* Buttons */
        button { padding: 10px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; transition: 0.2s; }
        .btn-heavy { background-color: #e74c3c; } /* Red */
        .btn-heavy:hover { background-color: #c0392b; }
        .btn-light { background-color: #2ecc71; } /* Green */
        .btn-light:hover { background-color: #27ae60; }
        .btn-toggle { background-color: #34495e; margin-bottom: 20px; }
        
        /* Status Text */
        .status { height: 20px; color: #555; font-size: 14px; margin-top: 5px; font-weight: bold;}
        .error-msg { color: red; animation: flash 1s; }
        
        @keyframes flash { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        /* Mode Indicator */
        #mode-display { font-size: 22px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .mode-desc { max-width: 600px; text-align: center; color: #666; margin-bottom: 30px; }
    </style>
</head>
<body>

    <h1>Bulkhead Pattern Simulator</h1>
    
    <div id="mode-display">Mode: Shared Resources (Monolith)</div>
    <div class="mode-desc" id="mode-desc">
        All tasks compete for the SAME pool of threads. If heavy tasks take them all, light tasks wait or fail.
    </div>

    <button class="btn-toggle" onclick="toggleMode()">Switch to Bulkhead Mode</button>

    <div class="container">
        
        <div class="service-card">
            <span class="service-title">üé• Video Processing Service</span>
            <p>Task Duration: 5 Seconds</p>
            <div id="pool-heavy" class="pool-container">
                </div>
            <button class="btn-heavy" onclick="addTask('heavy')">Start Heavy Task</button>
            <div id="status-heavy" class="status"></div>
        </div>

        <div class="service-card">
            <span class="service-title">üîê User Login Service</span>
            <p>Task Duration: 0.5 Seconds</p>
            <div id="pool-light" class="pool-container">
                </div>
            <button class="btn-light" onclick="addTask('light')">Start Login Task</button>
            <div id="status-light" class="status"></div>
        </div>

    </div>

    <script>
        let isBulkheadMode = false;
        const TOTAL_SLOTS = 10;
        const BULKHEAD_SPLIT = 5; // 5 slots for heavy, 5 for light in bulkhead mode
        
        // State
        let activeTasks = { heavy: 0, light: 0 };

        function renderPools() {
            const heavyContainer = document.getElementById('pool-heavy');
            const lightContainer = document.getElementById('pool-light');
            heavyContainer.innerHTML = '';
            lightContainer.innerHTML = '';

            if (!isBulkheadMode) {
                // Shared Mode: Heavy container holds ALL slots visually
                lightContainer.style.display = 'none'; // Hide light pool container
                
                for(let i=0; i<TOTAL_SLOTS; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    // Visual logic for shared pool
                    if (i < activeTasks.heavy) slot.classList.add('busy-heavy');
                    else if (i < activeTasks.heavy + activeTasks.light) slot.classList.add('busy-light');
                    heavyContainer.appendChild(slot);
                }
            } else {
                // Bulkhead Mode: Separate containers
                lightContainer.style.display = 'flex';

                // Heavy Pool
                for(let i=0; i<BULKHEAD_SPLIT; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    if (i < activeTasks.heavy) slot.classList.add('busy-heavy');
                    heavyContainer.appendChild(slot);
                }
                // Light Pool
                for(let i=0; i<BULKHEAD_SPLIT; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    if (i < activeTasks.light) slot.classList.add('busy-light');
                    lightContainer.appendChild(slot);
                }
            }
        }

        function addTask(type) {
            const totalActive = activeTasks.heavy + activeTasks.light;

            // --- LOGIC FOR SHARED MODE ---
            if (!isBulkheadMode) {
                if (totalActive >= TOTAL_SLOTS) {
                    showError(type, "System Overloaded! No Threads Available.");
                    return;
                }
            } 
            // --- LOGIC FOR BULKHEAD MODE ---
            else {
                if (activeTasks[type] >= BULKHEAD_SPLIT) {
                    showError(type, "Bulkhead Full! Task Rejected.");
                    return;
                }
            }

            // Start the task
            activeTasks[type]++;
            renderPools();

            // Simulate duration
            const duration = type === 'heavy' ? 5000 : 500; // 5s vs 0.5s
            setTimeout(() => {
                activeTasks[type]--;
                renderPools();
            }, duration);
        }

        function showError(type, msg) {
            const el = document.getElementById(type === 'heavy' ? 'status-heavy' : 'status-light');
            el.innerText = msg;
            el.classList.add('error-msg');
            setTimeout(() => {
                el.innerText = "";
                el.classList.remove('error-msg');
            }, 1000);
        }

        function toggleMode() {
            isBulkheadMode = !isBulkheadMode;
            // Reset tasks
            activeTasks = { heavy: 0, light: 0 };
            
            const title = document.getElementById('mode-display');
            const desc = document.getElementById('mode-desc');
            const btn = document.querySelector('.btn-toggle');

            if(isBulkheadMode) {
                title.innerText = "Mode: Bulkhead Pattern (Isolates)";
                title.style.color = "#2ecc71";
                desc.innerText = "Resources are partitioned. Even if Video Processing is 100% full, Login Service has its own dedicated slots.";
                btn.innerText = "Switch to Shared Mode";
            } else {
                title.innerText = "Mode: Shared Resources (Monolith)";
                title.style.color = "#333";
                desc.innerText = "All tasks compete for the SAME pool of threads. If heavy tasks take them all, light tasks wait or fail.";
                btn.innerText = "Switch to Bulkhead Mode";
            }
            renderPools();
        }

        // Init
        renderPools();
    </script>
</body>
</html>










<!DOCTYPE html>
<html>
<head>
    <title>IRCTC Tatkal Simulator (Bulkhead Demo)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f8f9fa; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        h1 { color: #005a9c; } /* IRCTC Blue */
        .container { display: flex; gap: 40px; margin-top: 20px; }
        
        /* The Service Cards */
        .service-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 320px; text-align: center; border-top: 5px solid #ccc; }
        .card-tatkal { border-top-color: #e74c3c; } /* Red for Rush */
        .card-login { border-top-color: #27ae60; }  /* Green for Safe */
        
        .service-title { font-weight: bold; font-size: 20px; margin-bottom: 10px; display: block; }
        .subtitle { color: #777; font-size: 14px; margin-bottom: 15px; }

        /* The Resource Slots */
        .pool-container { background: #eee; padding: 10px; border-radius: 8px; margin: 15px 0; min-height: 60px; display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
        .slot { width: 30px; height: 30px; border-radius: 4px; border: 2px solid #ccc; background: white; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        
        .slot.busy-tatkal { background-color: #e74c3c; border-color: #c0392b; color: white; content: "T"; } 
        .slot.busy-login { background-color: #2ecc71; border-color: #27ae60; color: white; } 
        
        /* Buttons */
        button { padding: 12px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; transition: 0.2s; font-size: 14px; }
        .btn-tatkal { background-color: #e74c3c; width: 100%; }
        .btn-tatkal:hover { background-color: #c0392b; }
        .btn-tatkal:active { transform: scale(0.98); }

        .btn-login { background-color: #2ecc71; width: 100%; }
        .btn-login:hover { background-color: #27ae60; }
        .btn-login:active { transform: scale(0.98); }

        .btn-toggle { background-color: #34495e; margin-bottom: 20px; width: auto; padding: 10px 30px; }
        
        /* Status Text */
        .status { height: 25px; color: #555; font-size: 14px; margin-top: 10px; font-weight: bold;}
        .error-msg { color: white; background: #e74c3c; padding: 2px 8px; border-radius: 4px; animation: shake 0.5s; }
        
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* Mode Indicator */
        #mode-display { font-size: 24px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .mode-desc { max-width: 650px; text-align: center; color: #666; margin-bottom: 30px; line-height: 1.5; }
    </style>
</head>
<body>

    <h1>IRCTC System Simulator</h1>
    
    <div id="mode-display">Mode: Shared Resources (Monolith)</div>
    <div class="mode-desc" id="mode-desc">
        All servers are in one shared pool. If "Tatkal Booking" hogs all connections, users cannot even Login to check PNR status.
    </div>

    <button class="btn-toggle" onclick="toggleMode()">Switch to Bulkhead Mode</button>

    <div class="container">
        
        <div class="service-card card-tatkal">
            <span class="service-title">üöÑ Tatkal Booking</span>
            <div class="subtitle">Heavy Load (Payment/Gateway)<br>Duration: 5 Seconds</div>
            
            <div id="pool-tatkal" class="pool-container">
                </div>
            
            <button class="btn-tatkal" onclick="addTask('tatkal')">‚ö° Book Tatkal Ticket</button>
            <div id="status-tatkal" class="status"></div>
        </div>

        <div class="service-card card-login">
            <span class="service-title">üë§ User Login / PNR</span>
            <div class="subtitle">Light Load (DB Query)<br>Duration: 0.5 Seconds</div>
            
            <div id="pool-login" class="pool-container">
                </div>
            
            <button class="btn-login" onclick="addTask('login')">üîç Check PNR / Login</button>
            <div id="status-login" class="status"></div>
        </div>

    </div>

    <script>
        let isBulkheadMode = false;
        const TOTAL_SLOTS = 12; // Total connections available
        const BULKHEAD_SPLIT = 6; // 6 for Tatkal, 6 for Login
        
        // State
        let activeTasks = { tatkal: 0, login: 0 };

        function renderPools() {
            const tatkalContainer = document.getElementById('pool-tatkal');
            const loginContainer = document.getElementById('pool-login');
            tatkalContainer.innerHTML = '';
            loginContainer.innerHTML = '';

            if (!isBulkheadMode) {
                // Shared Mode: Tatkal container holds ALL slots visually
                loginContainer.innerHTML = '<span style="color:#aaa; font-style:italic; padding-top:20px;">Using Shared Pool -></span>';
                
                for(let i=0; i<TOTAL_SLOTS; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    // Visual logic for shared pool
                    if (i < activeTasks.tatkal) {
                        slot.classList.add('busy-tatkal');
                        slot.innerText = "T";
                    }
                    else if (i < activeTasks.tatkal + activeTasks.login) {
                        slot.classList.add('busy-login');
                        slot.innerText = "L";
                    }
                    tatkalContainer.appendChild(slot);
                }
            } else {
                // Bulkhead Mode: Separate containers
                
                // Tatkal Pool
                for(let i=0; i<BULKHEAD_SPLIT; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    if (i < activeTasks.tatkal) {
                        slot.classList.add('busy-tatkal');
                        slot.innerText = "T";
                    }
                    tatkalContainer.appendChild(slot);
                }
                // Login Pool
                for(let i=0; i<BULKHEAD_SPLIT; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'slot';
                    if (i < activeTasks.login) {
                        slot.classList.add('busy-login');
                        slot.innerText = "L";
                    }
                    loginContainer.appendChild(slot);
                }
            }
        }

        function addTask(type) {
            const totalActive = activeTasks.tatkal + activeTasks.login;

            // --- LOGIC FOR SHARED MODE ---
            if (!isBulkheadMode) {
                if (totalActive >= TOTAL_SLOTS) {
                    showError(type, "SERVER BUSY! Please try again.");
                    return;
                }
            } 
            // --- LOGIC FOR BULKHEAD MODE ---
            else {
                if (activeTasks[type] >= BULKHEAD_SPLIT) {
                    if(type === 'tatkal') showError(type, "Tatkal Queue Full!");
                    if(type === 'login') showError(type, "Login Queue Full!");
                    return;
                }
            }

            // Start the task
            activeTasks[type]++;
            renderPools();

            // Simulate duration
            const duration = type === 'tatkal' ? 5000 : 500; // 5s vs 0.5s
            setTimeout(() => {
                activeTasks[type]--;
                renderPools();
            }, duration);
        }

        function showError(type, msg) {
            const el = document.getElementById(type === 'tatkal' ? 'status-tatkal' : 'status-login');
            el.innerText = msg;
            el.classList.add('error-msg');
            setTimeout(() => {
                el.innerText = "";
                el.classList.remove('error-msg');
            }, 1000);
        }

        function toggleMode() {
            isBulkheadMode = !isBulkheadMode;
            // Reset tasks for clean switch
            activeTasks = { tatkal: 0, login: 0 };
            
            const title = document.getElementById('mode-display');
            const desc = document.getElementById('mode-desc');
            const btn = document.querySelector('.btn-toggle');

            if(isBulkheadMode) {
                title.innerText = "Mode: Bulkhead Pattern (Safe Mode)";
                title.style.color = "#2ecc71";
                desc.innerText = "We have split the servers. Even if Tatkal is 100% full, the Login/PNR service has its own dedicated connections.";
                btn.innerText = "Reset to Shared Mode";
            } else {
                title.innerText = "Mode: Shared Resources (Monolith)";
                title.style.color = "#333";
                desc.innerText = "All servers are in one shared pool. If 'Tatkal Booking' hogs all connections, users cannot even Login to check PNR status.";
                btn.innerText = "Switch to Bulkhead Mode";
            }
            renderPools();
        }

        // Init
        renderPools();
    </script>
</body>
</html>








<!DOCTYPE html>
<html>
<head>
    <title>Strangler Fig Pattern Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #eef2f3; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 50px; margin-top: 40px; align-items: flex-start; }
        
        /* The Boxes */
        .box { padding: 20px; border-radius: 10px; text-align: center; width: 220px; min-height: 150px; position: relative; transition: all 0.5s; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Facade */
        .facade { background: #34495e; color: white; border: 4px solid #2c3e50; z-index: 10; }
        .facade::after { content: "‚ñº"; position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: 24px; color: #34495e; }

        /* Legacy */
        .legacy { background: #95a5a6; color: white; border: 4px dashed #7f8c8d; }
        .legacy.dying { opacity: 0.5; transform: scale(0.95); }
        .legacy.dead { opacity: 0.2; filter: grayscale(100%); }

        /* New Microservice */
        .microservice { background: #2ecc71; color: white; border: 4px solid #27ae60; opacity: 0.3; transform: scale(0.9); }
        .microservice.active { opacity: 1; transform: scale(1); box-shadow: 0 0 20px rgba(46, 204, 113, 0.6); }

        /* Features inside boxes */
        .feature { background: rgba(255,255,255,0.2); margin: 5px; padding: 5px; border-radius: 4px; font-size: 14px; }
        .feature.migrated { text-decoration: line-through; opacity: 0.5; background: rgba(0,0,0,0.2); }
        
        /* Request Dots */
        .dot { width: 15px; height: 15px; border-radius: 50%; position: absolute; transition: top 1s, left 1s; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .req-search { background: #f1c40f; } /* Yellow */
        .req-cart { background: #e67e22; }   /* Orange */
        .req-profile { background: #3498db; } /* Blue */

        /* Controls */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 40px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 600px; }
        button { padding: 10px 20px; margin: 0 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; font-size: 14px; transition: 0.2s; }
        
        .btn-send { background-color: #34495e; }
        .btn-send:hover { background-color: #2c3e50; }

        .btn-migrate { background-color: #2ecc71; opacity: 0.5; cursor: not-allowed; }
        .btn-migrate.ready { opacity: 1; cursor: pointer; }

        .switch-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .switch-box { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }

        h2 { margin-top: 0; }
        .arrow-line { position: absolute; background: #ccc; height: 4px; width: 100px; transform-origin: left center; z-index: 0; }
    </style>
</head>
<body>

    <h1>Strangler Fig Pattern Demo</h1>
    <p>Gradually migrating functionality from a Legacy Monolith to a New Microservice.</p>

    <div class="layout">
        
        <div id="legacy-box" class="box legacy">
            <h3>üèõÔ∏è Legacy Monolith</h3>
            <div id="leg-search" class="feature">üîç Search Function</div>
            <div id="leg-cart" class="feature">üõí Cart Function</div>
            <div id="leg-profile" class="feature">üë§ User Profile</div>
        </div>

        <div class="box facade">
            <h3>üîÄ Strangler Facade</h3>
            <div style="font-size: 12px; margin-top:10px;">Intercepts all calls.<br>Routes based on rules.</div>
        </div>

        <div id="micro-box" class="box microservice">
            <h3>üöÄ New Microservice</h3>
            <div id="new-search" class="feature" style="display:none;">üîç Search v2.0</div>
            <div id="new-cart" class="feature" style="display:none;">üõí Cart v2.0</div>
        </div>

    </div>

    <div class="controls">
        <div class="switch-container">
            <div class="switch-box">
                <h4>1. Send Traffic</h4>
                <button class="btn-send" onclick="sendRequest('search')">Send Search Req</button>
                <button class="btn-send" onclick="sendRequest('cart')">Send Cart Req</button>
                <button class="btn-send" onclick="sendRequest('profile')">Send Profile Req</button>
            </div>
            
            <div class="switch-box">
                <h4>2. Migration Controls</h4>
                <button id="btn-mig-search" class="btn-migrate ready" onclick="migrate('search')">Step 1: Strangle Search</button>
                <button id="btn-mig-cart" class="btn-migrate" onclick="migrate('cart')">Step 2: Strangle Cart</button>
                <button id="btn-kill" class="btn-migrate" style="background-color: #c0392b;" onclick="killLegacy()">Step 3: Kill Legacy</button>
            </div>
        </div>
        <div id="log" style="color: #777; font-size: 14px; min-height: 20px;">System Status: Legacy System handling 100% of traffic.</div>
    </div>

    <script>
        // State
        let routes = {
            search: 'legacy',
            cart: 'legacy',
            profile: 'legacy'
        };

        function sendRequest(type) {
            // Create visual dot
            const dot = document.createElement('div');
            dot.className = `dot req-${type}`;
            document.body.appendChild(dot);

            // 1. Start at Facade
            const facade = document.querySelector('.facade');
            const fRect = facade.getBoundingClientRect();
            
            // Set initial position (simulating coming from user below)
            dot.style.top = (fRect.bottom + 50) + 'px';
            dot.style.left = (fRect.left + fRect.width/2 - 7) + 'px';

            setTimeout(() => {
                // Move to Facade
                dot.style.top = (fRect.top + 50) + 'px';
                
                setTimeout(() => {
                    // 2. Route to Destination
                    const destination = routes[type];
                    const targetBox = destination === 'legacy' ? document.getElementById('legacy-box') : document.getElementById('micro-box');
                    const tRect = targetBox.getBoundingClientRect();

                    dot.style.top = (tRect.top + 50) + 'px';
                    dot.style.left = (tRect.left + tRect.width/2 - 7) + 'px';

                    // Cleanup
                    setTimeout(() => {
                        dot.remove();
                        pulseBox(targetBox);
                        log(`Request (${type}) handled by ${destination === 'legacy' ? 'Legacy Monolith' : 'New Microservice'}`);
                    }, 1000);

                }, 800);
            }, 100);
        }

        function migrate(feature) {
            if (feature === 'search') {
                // Logic
                routes.search = 'microservice';
                
                // Visuals
                document.getElementById('leg-search').classList.add('migrated');
                document.getElementById('micro-box').classList.add('active');
                document.getElementById('new-search').style.display = 'block';
                
                // Button Logic
                document.getElementById('btn-mig-search').classList.remove('ready');
                document.getElementById('btn-mig-search').style.opacity = '0.5';
                document.getElementById('btn-mig-cart').classList.add('ready');
                
                log("MIGRATION: 'Search' traffic now routed to Microservice.");
            }
            else if (feature === 'cart') {
                // Logic
                routes.cart = 'microservice';
                
                // Visuals
                document.getElementById('leg-cart').classList.add('migrated');
                document.getElementById('new-cart').style.display = 'block';
                document.getElementById('legacy-box').classList.add('dying');

                // Button Logic
                document.getElementById('btn-mig-cart').classList.remove('ready');
                document.getElementById('btn-mig-cart').style.opacity = '0.5';
                document.getElementById('btn-kill').classList.add('ready');

                log("MIGRATION: 'Cart' traffic now routed to Microservice. Legacy is dying.");
            }
        }

        function killLegacy() {
            if (!document.getElementById('btn-kill').classList.contains('ready')) return;
            
            document.getElementById('legacy-box').classList.add('dead');
            document.getElementById('leg-profile').classList.add('migrated'); // Assume profile retired
            log("COMPLETE: Legacy System Decommissioned. Long live the Microservice!");
        }

        function pulseBox(element) {
            element.style.transform = "scale(1.05)";
            setTimeout(() => element.style.transform = "scale(1)", 200);
        }

        function log(msg) {
            document.getElementById('log').innerText = msg;
        }
    </script>
</body>
</html>











<!DOCTYPE html>
<html>
<head>
    <title>Strangler Fig Pattern Demo (Fixed)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #eef2f3; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 50px; margin-top: 40px; align-items: flex-start; }
        
        /* The Boxes */
        .box { padding: 20px; border-radius: 10px; text-align: center; width: 220px; min-height: 180px; position: relative; transition: all 0.5s; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Facade */
        .facade { background: #34495e; color: white; border: 4px solid #2c3e50; z-index: 10; }
        .facade::after { content: "‚ñº"; position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: 24px; color: #34495e; }

        /* Legacy */
        .legacy { background: #95a5a6; color: white; border: 4px dashed #7f8c8d; }
        .legacy.dying { opacity: 0.6; transform: scale(0.95); }
        .legacy.dead { opacity: 0.2; filter: grayscale(100%); transform: scale(0.9); }

        /* New Microservice */
        .microservice { background: #2ecc71; color: white; border: 4px solid #27ae60; opacity: 0.3; transform: scale(0.9); }
        .microservice.active { opacity: 1; transform: scale(1); box-shadow: 0 0 20px rgba(46, 204, 113, 0.6); }

        /* Features inside boxes */
        .feature { background: rgba(255,255,255,0.2); margin: 8px; padding: 8px; border-radius: 4px; font-size: 14px; transition: all 0.5s; }
        .feature.migrated { text-decoration: line-through; opacity: 0.4; background: rgba(0,0,0,0.2); }
        
        /* Request Dots */
        .dot { width: 15px; height: 15px; border-radius: 50%; position: absolute; transition: top 1s, left 1s; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .req-search { background: #f1c40f; } /* Yellow */
        .req-cart { background: #e67e22; }   /* Orange */
        .req-profile { background: #3498db; } /* Blue */

        /* Controls */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 40px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 700px; }
        button { padding: 8px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; font-size: 13px; transition: 0.2s; }
        
        .btn-send { background-color: #34495e; }
        .btn-send:hover { background-color: #2c3e50; }

        .btn-migrate { background-color: #2ecc71; opacity: 0.5; cursor: not-allowed; }
        .btn-migrate.ready { opacity: 1; cursor: pointer; }

        .switch-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .switch-box { border: 1px solid #ddd; padding: 15px; border-radius: 5px; }

        h2 { margin-top: 0; }
    </style>
</head>
<body>

    <h1>Strangler Fig Pattern Demo</h1>
    <p>Gradually migrating functionality from a Legacy Monolith to a New Microservice.</p>

    <div class="layout">
        
        <div id="legacy-box" class="box legacy">
            <h3>üèõÔ∏è Legacy Monolith</h3>
            <div id="leg-search" class="feature">üîç Search Function</div>
            <div id="leg-cart" class="feature">üõí Cart Function</div>
            <div id="leg-profile" class="feature">üë§ User Profile</div>
        </div>

        <div class="box facade">
            <h3>üîÄ Strangler Facade</h3>
            <div style="font-size: 12px; margin-top:10px;">Intercepts all calls.<br>Routes based on rules.</div>
        </div>

        <div id="micro-box" class="box microservice">
            <h3>üöÄ New Microservice</h3>
            <div id="new-search" class="feature" style="display:none;">üîç Search v2.0</div>
            <div id="new-cart" class="feature" style="display:none;">üõí Cart v2.0</div>
            <div id="new-profile" class="feature" style="display:none;">üë§ Profile v2.0</div>
        </div>

    </div>

    <div class="controls">
        <div class="switch-container">
            <div class="switch-box">
                <h4>1. Send Traffic</h4>
                <button class="btn-send" onclick="sendRequest('search')">Send Search Req</button>
                <button class="btn-send" onclick="sendRequest('cart')">Send Cart Req</button>
                <button class="btn-send" onclick="sendRequest('profile')">Send Profile Req</button>
            </div>
            
            <div class="switch-box">
                <h4>2. Migration Controls</h4>
                <button id="btn-mig-search" class="btn-migrate ready" onclick="migrate('search')">Step 1: Strangle Search</button>
                <button id="btn-mig-cart" class="btn-migrate" onclick="migrate('cart')">Step 2: Strangle Cart</button>
                <button id="btn-mig-profile" class="btn-migrate" onclick="migrate('profile')">Step 3: Strangle Profile</button>
                <button id="btn-kill" class="btn-migrate" style="background-color: #c0392b;" onclick="killLegacy()">Step 4: Kill Legacy</button>
            </div>
        </div>
        <div id="log" style="color: #777; font-size: 14px; min-height: 20px;">System Status: Legacy System handling 100% of traffic.</div>
    </div>

    <script>
        // State
        let routes = {
            search: 'legacy',
            cart: 'legacy',
            profile: 'legacy'
        };

        function sendRequest(type) {
            // Create visual dot
            const dot = document.createElement('div');
            dot.className = `dot req-${type}`;
            document.body.appendChild(dot);

            // 1. Start at Facade
            const facade = document.querySelector('.facade');
            const fRect = facade.getBoundingClientRect();
            
            // Set initial position (simulating coming from user below)
            dot.style.top = (fRect.bottom + 50) + 'px';
            dot.style.left = (fRect.left + fRect.width/2 - 7) + 'px';

            setTimeout(() => {
                // Move to Facade
                dot.style.top = (fRect.top + 50) + 'px';
                
                setTimeout(() => {
                    // 2. Route to Destination
                    const destination = routes[type];
                    const targetBox = destination === 'legacy' ? document.getElementById('legacy-box') : document.getElementById('micro-box');
                    const tRect = targetBox.getBoundingClientRect();

                    dot.style.top = (tRect.top + 50) + 'px';
                    dot.style.left = (tRect.left + tRect.width/2 - 7) + 'px';

                    // Cleanup
                    setTimeout(() => {
                        dot.remove();
                        pulseBox(targetBox);
                        log(`Request (${type}) handled by ${destination === 'legacy' ? 'Legacy Monolith' : 'New Microservice'}`);
                    }, 1000);

                }, 800);
            }, 100);
        }

        function migrate(feature) {
            if (feature === 'search') {
                if (!document.getElementById('btn-mig-search').classList.contains('ready')) return;
                
                routes.search = 'microservice';
                document.getElementById('leg-search').classList.add('migrated');
                document.getElementById('micro-box').classList.add('active');
                document.getElementById('new-search').style.display = 'block';
                
                // Button Logic: Disable current, enable next
                disableBtn('btn-mig-search');
                enableBtn('btn-mig-cart');
                
                log("MIGRATION: 'Search' traffic routed to Microservice.");
            }
            else if (feature === 'cart') {
                if (!document.getElementById('btn-mig-cart').classList.contains('ready')) return;
                
                routes.cart = 'microservice';
                document.getElementById('leg-cart').classList.add('migrated');
                document.getElementById('new-cart').style.display = 'block';
                document.getElementById('legacy-box').classList.add('dying'); // Visual hint it's getting emptier

                // Button Logic
                disableBtn('btn-mig-cart');
                enableBtn('btn-mig-profile');

                log("MIGRATION: 'Cart' traffic routed to Microservice.");
            }
            else if (feature === 'profile') {
                if (!document.getElementById('btn-mig-profile').classList.contains('ready')) return;
                
                routes.profile = 'microservice';
                document.getElementById('leg-profile').classList.add('migrated');
                document.getElementById('new-profile').style.display = 'block';

                // Button Logic
                disableBtn('btn-mig-profile');
                enableBtn('btn-kill');

                log("MIGRATION: 'Profile' traffic routed. Legacy is now 100% idle.");
            }
        }

        function killLegacy() {
            if (!document.getElementById('btn-kill').classList.contains('ready')) return;
            
            document.getElementById('legacy-box').classList.add('dead');
            disableBtn('btn-kill');
            log("COMPLETE: Legacy System Decommissioned. Long live the Microservice!");
        }

        function enableBtn(id) {
            document.getElementById(id).classList.add('ready');
            document.getElementById(id).style.opacity = '1';
        }

        function disableBtn(id) {
            document.getElementById(id).classList.remove('ready');
            document.getElementById(id).style.opacity = '0.5';
        }

        function pulseBox(element) {
            element.style.transform = "scale(1.05)";
            setTimeout(() => element.style.transform = "scale(1)", 200);
        }

        function log(msg) {
            document.getElementById('log').innerText = msg;
        }
    </script>
</body>
</html>












<!DOCTYPE html>
<html>
<head>
    <title>Strangler Pattern: Data Consistency Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 80px; margin-top: 50px; align-items: flex-start; }
        
        /* Systems */
        .system-col { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 250px; }
        
        .app-box { padding: 20px; border-radius: 8px; text-align: center; width: 100%; color: white; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 2; }
        .legacy-app { background: #7f8c8d; border: 4px solid #555; }
        .new-app { background: #27ae60; border: 4px solid #2ecc71; opacity: 0.5; } /* Starts dimmed */
        .new-app.active { opacity: 1; box-shadow: 0 0 15px #2ecc71; }

        /* Databases (Cylinders) */
        .db-container { position: relative; width: 120px; height: 140px; }
        .db { width: 100%; height: 100px; border-radius: 50%/20px; position: absolute; bottom: 0; z-index: 1; border: 2px solid rgba(0,0,0,0.2); transition: all 0.3s; display: flex; align-items: center; justify-content: center; flex-direction: column; font-size: 13px; }
        .db::before { content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.2); z-index: 2; background: inherit; }
        
        .legacy-db { background: #95a5a6; color: white; }
        .new-db { background: #2ecc71; color: white; }

        .data-row { background: rgba(255,255,255,0.3); margin: 2px; padding: 2px 10px; border-radius: 4px; font-family: monospace; width: 80%; text-align: center; }

        /* Sync Pipe */
        .sync-pipe { position: absolute; top: 250px; left: 50%; transform: translateX(-50%); width: 200px; height: 10px; background: #ddd; border-radius: 5px; z-index: 0; display: flex; align-items: center; justify-content: center; }
        .sync-label { position: absolute; top: -25px; font-size: 12px; color: #777; font-weight: bold; }
        
        /* Moving Packet */
        .packet { width: 15px; height: 15px; background: #e67e22; border-radius: 50%; position: absolute; z-index: 10; box-shadow: 0 0 5px orange; display: none; }

        /* Controls */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 50px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 600px; }
        button { padding: 10px 20px; margin: 0 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; font-size: 14px; transition: 0.2s; }
        
        .btn-write { background-color: #3498db; }
        .btn-write:hover { background-color: #2980b9; }

        .btn-switch { background-color: #f1c40f; color: #333; }
        .btn-switch:hover { background-color: #f39c12; }

        .status-log { margin-top: 15px; color: #555; font-size: 14px; font-family: monospace; }
        .sync-status { font-weight: bold; color: #e74c3c; }
        .sync-status.synced { color: #27ae60; }

    </style>
</head>
<body>

    <h1>Data Consistency Simulator</h1>
    <p>Ensuring the New Database has the same data as the Old Database <i>before</i> we switch users over.</p>

    <div class="layout">
        
        <div class="system-col">
            <div class="app-box legacy-app">Legacy Monolith<br>(Active)</div>
            <div class="db-container">
                <div class="db legacy-db">
                    <div style="margin-top:20px">LEGACY DB</div>
                    <div class="data-row" id="data-old">Ver: 1.0</div>
                </div>
            </div>
        </div>

        <div class="sync-pipe">
            <span class="sync-label">üîÑ CDC Sync Agent</span>
        </div>

        <div class="system-col">
            <div id="new-app-box" class="app-box new-app">Microservice<br>(Standby)</div>
            <div class="db-container">
                <div class="db new-db">
                    <div style="margin-top:20px">NEW DB</div>
                    <div class="data-row" id="data-new">Ver: 0.0</div>
                </div>
            </div>
        </div>

    </div>

    <div id="packet" class="packet"></div>

    <div class="controls">
        <div style="margin-bottom: 15px;">
            <button class="btn-write" onclick="updateLegacyData()">1. User Updates Profile (Legacy)</button>
            <button class="btn-switch" onclick="switchTraffic()">2. Switch Traffic to New</button>
        </div>
        
        <div class="status-log">
            Database Status: <span id="sync-status" class="sync-status">OUT OF SYNC</span>
            <br>
            <span id="log-msg">Waiting for user action...</span>
        </div>
    </div>

    <script>
        let version = 1;
        let newDbVersion = 0;
        let isTrafficSwitched = false;

        function updateLegacyData() {
            if(isTrafficSwitched) {
                log("Error: Traffic already switched. Use the New System!", true);
                return;
            }

            // 1. Update Legacy
            version++;
            document.getElementById('data-old').innerText = "Ver: " + version + ".0";
            updateSyncStatus();
            log("User saved data to Legacy DB. Sync process starting...");

            // 2. Animate Sync
            animateSync();
        }

        function animateSync() {
            const packet = document.getElementById('packet');
            const startRect = document.querySelector('.legacy-db').getBoundingClientRect();
            const endRect = document.querySelector('.new-db').getBoundingClientRect();

            // Start Position
            packet.style.display = 'block';
            packet.style.top = (startRect.top + 50) + 'px';
            packet.style.left = (startRect.left + 50) + 'px';

            // Animation
            setTimeout(() => {
                packet.style.transition = "all 1s ease-in-out";
                packet.style.left = (endRect.left + 50) + 'px';
                
                // End Position logic
                setTimeout(() => {
                    packet.style.display = 'none';
                    packet.style.transition = "none"; // reset
                    
                    // Update New DB
                    newDbVersion = version;
                    document.getElementById('data-new').innerText = "Ver: " + newDbVersion + ".0";
                    pulse(document.querySelector('.new-db'));
                    updateSyncStatus();
                    log("Sync Complete! New DB updated via background process.");
                }, 1000);
            }, 100);
        }

        function switchTraffic() {
            if (version !== newDbVersion) {
                log("‚ö†Ô∏è DANGER: Cannot switch! Databases are out of sync. Wait for sync.", true);
                return;
            }

            isTrafficSwitched = true;
            document.querySelector('.legacy-app').style.opacity = "0.5";
            document.querySelector('.legacy-app').innerText = "Legacy Monolith\n(Idle)";
            
            const newApp = document.getElementById('new-app-box');
            newApp.classList.add('active');
            newApp.innerText = "Microservice\n(ACTIVE)";
            
            document.querySelector('.btn-write').innerText = "User Updates Profile (Microservice)";
            document.querySelector('.btn-write').setAttribute('onclick', 'updateNewDataOnly()');
            document.querySelector('.btn-switch').style.display = 'none'; // Hide switch button

            log("SUCCESS: Traffic Switched! The New System is now the Master.");
        }

        function updateNewDataOnly() {
            version++;
            newDbVersion = version;
            document.getElementById('data-new').innerText = "Ver: " + version + ".0";
            pulse(document.querySelector('.new-db'));
            log("User updated data directly in New System. Legacy is now obsolete.");
        }

        function updateSyncStatus() {
            const statusEl = document.getElementById('sync-status');
            if(version === newDbVersion) {
                statusEl.innerText = "SYNCED";
                statusEl.className = "sync-status synced";
            } else {
                statusEl.innerText = "SYNCING...";
                statusEl.className = "sync-status";
            }
        }

        function pulse(el) {
            el.style.transform = "scale(1.1)";
            el.style.borderColor = "white";
            setTimeout(() => {
                el.style.transform = "scale(1)";
                el.style.borderColor = "rgba(0,0,0,0.2)";
            }, 200);
        }

        function log(msg, isError = false) {
            const el = document.getElementById('log-msg');
            el.innerText = msg;
            el.style.color = isError ? "red" : "#555";
        }
    </script>
</body>
</html>












<!DOCTYPE html>
<html>
<head>
    <title>API Gateway Pattern Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; justify-content: space-between; width: 900px; margin-top: 60px; position: relative; }
        
        /* CLIENT */
        .client-zone { width: 200px; display: flex; flex-direction: column; align-items: center; }
        .phone { width: 100px; height: 180px; background: #34495e; border: 4px solid #95a5a6; border-radius: 15px; position: relative; box-shadow: 0 0 15px rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .screen { width: 80px; height: 140px; background: white; border-radius: 5px; overflow: hidden; display: flex; flex-direction: column; }
        .app-header { background: #3498db; height: 20px; width: 100%; }
        .app-body { padding: 5px; color: #333; font-size: 10px; flex-grow: 1; }

        /* GATEWAY */
        .gateway-zone { width: 250px; display: flex; flex-direction: column; align-items: center; z-index: 10; }
        .gateway { width: 200px; height: 220px; background: #e67e22; border-radius: 10px; border: 4px solid #d35400; position: relative; box-shadow: 0 0 20px rgba(230, 126, 34, 0.4); display: flex; flex-direction: column; align-items: center; padding: 10px; color: #fff; }
        .gateway-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; border-bottom: 2px solid rgba(255,255,255,0.3); width: 100%; text-align: center; padding-bottom: 5px; }
        
        .routing-table { font-size: 12px; background: rgba(0,0,0,0.2); width: 100%; border-radius: 5px; padding: 5px; margin-bottom: 10px; font-family: monospace; }
        .route-row { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); padding: 2px 0; }
        .active-route { background: rgba(255,255,255,0.3); color: white; font-weight: bold; }

        .security-guard { font-size: 30px; margin-top: auto; filter: grayscale(100%); transition: 0.3s; }
        .security-guard.alert { filter: grayscale(0%); transform: scale(1.2); }

        /* SERVICES */
        .services-zone { width: 200px; display: flex; flex-direction: column; gap: 20px; }
        .microservice { padding: 15px; border-radius: 8px; text-align: center; color: white; font-weight: bold; position: relative; transition: 0.3s; opacity: 0.7; }
        .microservice.active { opacity: 1; transform: scale(1.05); box-shadow: 0 0 15px white; }
        
        .svc-product { background: #27ae60; border: 2px solid #2ecc71; } /* Green */
        .svc-order { background: #8e44ad; border: 2px solid #9b59b6; }   /* Purple */
        .svc-user { background: #2980b9; border: 2px solid #3498db; }    /* Blue */

        /* ANIMATION DOTS */
        .dot { width: 15px; height: 15px; background: white; border-radius: 50%; position: absolute; z-index: 100; box-shadow: 0 0 5px white; display: none; }
        .dot.security-fail { background: red; box-shadow: 0 0 10px red; }

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 50px; width: 700px; color: #333; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .input-group { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; align-items: center; }
        
        select, input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }
        
        button { padding: 10px 20px; cursor: pointer; background: #34495e; color: white; border: none; border-radius: 5px; font-weight: bold; transition: 0.2s; }
        button:hover { background: #2c3e50; }

        .log-area { background: #eee; padding: 10px; border-radius: 5px; height: 40px; display: flex; align-items: center; justify-content: center; font-family: monospace; font-size: 14px; color: #555; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 5px; font-weight: bold; color: #333; }
        
        /* Connections */
        .connector { position: absolute; background: #7f8c8d; height: 2px; z-index: 0; transform-origin: left center; }

    </style>
</head>
<body>

    <h1>API Gateway Simulator</h1>
    <p>Single Entry Point. Intelligent Routing. Centralized Security.</p>

    <div class="layout">
        
        <div class="client-zone">
            <h3>Client App</h3>
            <div class="phone">
                <div class="screen">
                    <div class="app-header"></div>
                    <div class="app-body" id="app-screen">
                        Ready...
                    </div>
                </div>
            </div>
            <div style="font-size: 12px; margin-top: 10px; color: #ccc;">Knowing only:<br>api.shop.com</div>
        </div>

        <div class="gateway-zone">
            <h3>API Gateway</h3>
            <div class="gateway">
                <div class="gateway-title">ROUTER</div>
                
                <div class="routing-table">
                    <div class="route-row" id="row-prod">/products &rarr; 10.0.1.5</div>
                    <div class="route-row" id="row-order">/orders &rarr; 10.0.1.6</div>
                    <div class="route-row" id="row-user">/users &rarr; 10.0.1.7</div>
                </div>

                <div style="font-size: 10px; margin-top: 10px;">üõ°Ô∏è SECURITY LAYER</div>
                <div class="security-guard" id="guard">üëÆ</div>
            </div>
        </div>

        <div class="services-zone">
            <div class="microservice svc-product" id="svc-prod">
                üì¶ Product Service<br>
                <small>10.0.1.5:8081</small>
            </div>
            <div class="microservice svc-order" id="svc-order">
                üõí Order Service<br>
                <small>10.0.1.6:8082</small>
            </div>
            <div class="microservice svc-user" id="svc-user">
                üë§ User Service<br>
                <small>10.0.1.7:8083</small>
            </div>
        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <div class="input-group">
            <label>Request Path:</label>
            <select id="path-select">
                <option value="products">/products (Get Catalog)</option>
                <option value="orders">/orders (My History)</option>
                <option value="users">/users (My Profile)</option>
                <option value="admin">/admin (Unknown Path)</option>
            </select>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="auth-check" checked>
                <label for="auth-check">Include Auth Token (Key)</label>
            </div>

            <button onclick="sendRequest()">Send Request</button>
        </div>
        
        <div class="log-area" id="log">Waiting for request...</div>
    </div>

    <script>
        function sendRequest() {
            const path = document.getElementById('path-select').value;
            const hasAuth = document.getElementById('auth-check').checked;
            const dot = document.getElementById('dot');
            const guard = document.getElementById('guard');
            
            // Reset Visuals
            resetVisuals();
            log("Sending request to https://api.shop.com/" + path + "...");

            // 1. Animate Client to Gateway
            const clientRect = document.querySelector('.phone').getBoundingClientRect();
            const gatewayRect = document.querySelector('.gateway').getBoundingClientRect();

            dot.style.display = 'block';
            dot.style.backgroundColor = 'white';
            dot.style.top = (clientRect.top + 80) + 'px';
            dot.style.left = (clientRect.left + 50) + 'px';

            setTimeout(() => {
                dot.style.transition = "all 0.8s ease-in-out";
                dot.style.top = (gatewayRect.top + 100) + 'px';
                dot.style.left = (gatewayRect.left + 20) + 'px';

                // ARRIVED AT GATEWAY
                setTimeout(() => {
                    
                    // SECURITY CHECK
                    if (!hasAuth) {
                        log("‚õî BLOCKED: 401 Unauthorized. Gateway rejected the request.");
                        guard.innerText = "üõë";
                        guard.classList.add('alert');
                        dot.classList.add('security-fail');
                        shake(document.querySelector('.gateway'));
                        
                        setTimeout(() => { 
                            dot.style.display = 'none'; 
                            dot.classList.remove('security-fail');
                            guard.innerText = "üëÆ";
                            guard.classList.remove('alert');
                        }, 1500);
                        return;
                    }

                    // ROUTING CHECK
                    guard.innerText = "‚úÖ"; // Pass
                    
                    let targetId = "";
                    let routeRowId = "";

                    if (path === 'products') { targetId = 'svc-prod'; routeRowId = 'row-prod'; }
                    else if (path === 'orders') { targetId = 'svc-order'; routeRowId = 'row-order'; }
                    else if (path === 'users') { targetId = 'svc-user'; routeRowId = 'row-user'; }
                    else {
                        log("‚ö†Ô∏è ERROR: 404 Not Found. Gateway doesn't know this route.");
                        shake(document.querySelector('.gateway'));
                        dot.style.display = 'none';
                        return;
                    }

                    // Highlight Routing Table
                    document.getElementById(routeRowId).classList.add('active-route');
                    log(`Routing: Map /${path} -> ${document.getElementById(targetId).querySelector('small').innerText}`);

                    // 2. Animate Gateway to Service
                    const svcBox = document.getElementById(targetId);
                    const svcRect = svcBox.getBoundingClientRect();

                    dot.style.top = (svcRect.top + 20) + 'px';
                    dot.style.left = (svcRect.left - 10) + 'px';

                    setTimeout(() => {
                        pulse(svcBox);
                        log("‚úÖ SUCCESS: 200 OK. Response received from Microservice.");
                        document.getElementById('app-screen').innerText = "Data Loaded:\n" + path.toUpperCase();
                        
                        // Cleanup
                        setTimeout(() => {
                            dot.style.display = 'none';
                            dot.style.transition = 'none';
                            document.getElementById(routeRowId).classList.remove('active-route');
                            guard.innerText = "üëÆ";
                        }, 1000);

                    }, 800);

                }, 800);
            }, 100);
        }

        function resetVisuals() {
            document.querySelectorAll('.microservice').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.route-row').forEach(el => el.classList.remove('active-route'));
            document.getElementById('app-screen').innerText = "Loading...";
        }

        function pulse(el) {
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 500);
        }

        function shake(el) {
            el.style.transform = "translateX(5px)";
            setTimeout(() => el.style.transform = "translateX(-5px)", 100);
            setTimeout(() => el.style.transform = "translateX(5px)", 200);
            setTimeout(() => el.style.transform = "translateX(0)", 300);
        }

        function log(msg) {
            document.getElementById('log').innerText = msg;
        }
    </script>
</body>
</html>










<!DOCTYPE html>
<html>
<head>
    <title>Service Registry Pattern Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f3f4; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 60px; margin-top: 40px; align-items: flex-start; width: 900px; justify-content: center; }
        
        /* BOX STYLES */
        .box { padding: 15px; border-radius: 8px; text-align: center; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.3s; }
        
        /* CLIENT */
        .client-box { width: 180px; background: #34495e; color: white; border: 4px solid #2c3e50; min-height: 150px; display: flex; flex-direction: column; justify-content: center; }
        .client-screen { background: white; color: #333; margin-top: 10px; padding: 5px; font-family: monospace; font-size: 11px; height: 60px; overflow: hidden; border-radius: 4px; text-align: left; }

        /* REGISTRY (EUREKA) */
        .registry-box { width: 280px; background: #8e44ad; color: white; border: 4px solid #6c3483; min-height: 200px; z-index: 10; }
        .registry-title { font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; margin-bottom: 10px; }
        
        .registry-table { width: 100%; font-size: 12px; border-collapse: collapse; color: white; }
        .registry-table th { text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); padding: 4px; }
        .registry-table td { padding: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .status-up { color: #2ecc71; font-weight: bold; }
        
        /* CLOUD ZONE (Services) */
        .cloud-zone { width: 250px; min-height: 300px; border: 3px dashed #bdc3c7; border-radius: 15px; padding: 10px; display: flex; flex-direction: column; gap: 10px; align-items: center; position: relative; background: rgba(255,255,255,0.5); }
        .cloud-label { font-weight: bold; color: #7f8c8d; font-size: 14px; margin-bottom: 5px; }

        .service-instance { width: 200px; padding: 10px; background: #27ae60; color: white; border-radius: 6px; font-size: 13px; position: relative; animation: popIn 0.5s; cursor: pointer; border: 2px solid #2ecc71; }
        .service-instance:hover { transform: scale(1.02); }
        .service-instance.dead { background: #c0392b; border-color: #e74c3c; animation: shake 0.5s; }
        
        .svc-details { font-size: 10px; opacity: 0.8; margin-top: 2px; }

        /* ANIMATION DOTS */
        .dot { width: 12px; height: 12px; border-radius: 50%; position: absolute; z-index: 100; display: none; }
        .dot-reg { background: #f1c40f; box-shadow: 0 0 8px #f1c40f; } /* Yellow for Registration */
        .dot-req { background: #3498db; box-shadow: 0 0 8px #3498db; } /* Blue for Client Request */

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 40px; width: 700px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .btn-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        
        button { padding: 10px 15px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; color: white; font-size: 13px; }
        .btn-add { background: #27ae60; }
        .btn-add:hover { background: #219150; }
        
        .btn-kill { background: #c0392b; }
        .btn-kill:hover { background: #a93226; }

        .btn-call { background: #34495e; font-size: 15px; padding: 12px 25px; }
        .btn-call:hover { background: #2c3e50; }

        .log-display { font-family: monospace; color: #555; font-size: 13px; height: 20px; }

        /* KEYFRAMES */
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

    <h1>Service Registry Pattern Demo</h1>
    <p>Dynamic Discovery: Services register themselves so clients don't need hardcoded IPs.</p>

    <div class="layout">
        
        <div class="client-box" id="client">
            <div>üì± Client App</div>
            <div class="client-screen" id="client-log">
                > System Ready.<br>
                > No Target IP.
            </div>
        </div>

        <div class="registry-box" id="registry">
            <div class="registry-title">üìí Service Registry (Eureka)</div>
            <table class="registry-table" id="reg-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Address</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reg-body">
                    </tbody>
            </table>
            <div style="font-size:10px; margin-top:10px; opacity:0.7;">* Auto-updates every 5s</div>
        </div>

        <div class="cloud-zone">
            <div class="cloud-label">‚òÅÔ∏è AWS / Cloud Region</div>
            <div id="services-container">
                </div>
        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <div class="btn-group">
            <button class="btn-add" onclick="spawnService()">+ Start New Instance</button>
            <button class="btn-kill" onclick="killRandomService()">- Kill Random Instance</button>
        </div>
        <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
        <div class="btn-group">
            <button class="btn-call" onclick="clientCallService()">üìû Client: Call 'Inventory'</button>
        </div>
        <div class="log-display" id="main-log">Waiting for action...</div>
    </div>

    <script>
        let services = [];
        let serviceCounter = 1;
        const basePort = 8080;

        function spawnService() {
            const port = basePort + serviceCounter;
            const id = `svc-${serviceCounter}`;
            
            // 1. Create Visual Element
            const svcDiv = document.createElement('div');
            svcDiv.className = 'service-instance';
            svcDiv.id = id;
            svcDiv.innerHTML = `üì¶ Inventory Service<div class="svc-details">ID: ${id} | IP: 10.0.0.${serviceCounter}:${port}</div>`;
            document.getElementById('services-container').appendChild(svcDiv);

            const svcObj = { id: id, name: 'INVENTORY-SERVICE', ip: `10.0.0.${serviceCounter}`, port: port };
            services.push(svcObj);
            
            // 2. Animate Registration (Service -> Registry)
            animatePacket(svcDiv, document.getElementById('registry'), 'dot-reg', () => {
                updateRegistryTable();
                log(`‚úÖ ${id} registered itself at ${svcObj.ip}:${port}`);
            });

            serviceCounter++;
        }

        function killRandomService() {
            if (services.length === 0) {
                log("‚ö†Ô∏è No services to kill!");
                return;
            }

            // Remove logic
            const victimIndex = Math.floor(Math.random() * services.length);
            const victim = services[victimIndex];
            services.splice(victimIndex, 1);

            // Update Visuals
            const el = document.getElementById(victim.id);
            el.classList.add('dead');
            el.innerHTML = "üíÄ CRASHED";
            
            setTimeout(() => {
                el.remove();
                updateRegistryTable(); // Auto-deregister
                log(`‚ùå ${victim.id} crashed. Removed from Registry.`);
            }, 800);
        }

        function updateRegistryTable() {
            const tbody = document.getElementById('reg-body');
            tbody.innerHTML = "";
            
            if (services.length === 0) {
                tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; opacity:0.5;'>Empty...</td></tr>";
                return;
            }

            services.forEach(svc => {
                const row = `<tr><td>${svc.name}</td><td>${svc.ip}:${svc.port}</td><td class="status-up">UP</td></tr>`;
                tbody.innerHTML += row;
            });
        }

        function clientCallService() {
            const clientLog = document.getElementById('client-log');
            const clientBox = document.getElementById('client');
            const registryBox = document.getElementById('registry');

            // Step 1: Client Checks Registry
            log("üîé Client querying Registry for 'INVENTORY-SERVICE'...");
            clientLog.innerHTML = "> Lookup: INVENTORY...";
            
            animatePacket(clientBox, registryBox, 'dot-req', () => {
                
                // Step 2: Registry Response
                if (services.length === 0) {
                    clientLog.innerHTML += "<br>> <span style='color:red'>ERROR: Service Not Found</span>";
                    log("‚õî Registry returned empty list. Call failed.");
                    shake(clientBox);
                    return;
                }

                // Load Balancing (Round Robin simulated by picking random)
                const target = services[Math.floor(Math.random() * services.length)];
                clientLog.innerHTML += `<br>> Found: ${target.ip}:${target.port}`;
                
                // Step 3: Client Calls Service directly
                const targetEl = document.getElementById(target.id);
                
                setTimeout(() => {
                    log(`üöÄ Calling Service at ${target.ip}:${target.port}...`);
                    animatePacket(clientBox, targetEl, 'dot-req', () => {
                        pulse(targetEl);
                        clientLog.innerHTML += "<br>> <span style='color:green'>SUCCESS: 200 OK</span>";
                        log("‚úÖ Request successfully handled by " + target.id);
                    });
                }, 500);
            });
        }

        // --- ANIMATION UTILS ---
        function animatePacket(fromEl, toEl, dotClass, callback) {
            const dot = document.getElementById('dot');
            dot.className = `dot ${dotClass}`;
            dot.style.display = 'block';

            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();

            // Start Position
            dot.style.top = (fromRect.top + fromRect.height/2) + 'px';
            dot.style.left = (fromRect.left + fromRect.width/2) + 'px';
            dot.style.transition = 'none'; // reset

            // Force reflow
            void dot.offsetWidth; 

            // End Position
            dot.style.transition = 'all 0.6s ease-in-out';
            dot.style.top = (toRect.top + toRect.height/2) + 'px';
            dot.style.left = (toRect.left + toRect.width/2) + 'px';

            setTimeout(() => {
                dot.style.display = 'none';
                if(callback) callback();
            }, 600);
        }

        function pulse(el) {
            el.style.transform = "scale(1.1)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }

        function shake(el) {
            el.style.animation = 'shake 0.5s';
            setTimeout(() => el.style.animation = '', 500);
        }

        function log(msg) {
            document.getElementById('main-log').innerText = msg;
        }

        // Init
        updateRegistryTable();
    </script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
    <title>Service Registry: 3-Node Load Balancing Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f7; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 40px; margin-top: 30px; align-items: flex-start; width: 950px; justify-content: center; }
        
        /* BOX STYLES */
        .box { padding: 15px; border-radius: 8px; text-align: center; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.3s; }
        
        /* CLIENT */
        .client-box { width: 180px; background: #2c3e50; color: white; border: 4px solid #1a252f; min-height: 200px; display: flex; flex-direction: column; justify-content: center; }
        .client-screen { background: #000; color: #0f0; margin-top: 10px; padding: 8px; font-family: monospace; font-size: 11px; height: 100px; overflow: hidden; border-radius: 4px; text-align: left; border: 1px solid #555; }

        /* REGISTRY (EUREKA) */
        .registry-box { width: 260px; background: #8e44ad; color: white; border: 4px solid #6c3483; min-height: 250px; z-index: 10; }
        .registry-title { font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; margin-bottom: 10px; }
        
        .registry-table { width: 100%; font-size: 11px; border-collapse: collapse; color: white; }
        .registry-table th { text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); padding: 4px; }
        .registry-table td { padding: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .status-up { color: #2ecc71; font-weight: bold; }
        
        /* CLOUD ZONE (Services) */
        .cloud-zone { width: 280px; min-height: 350px; border: 3px dashed #bdc3c7; border-radius: 15px; padding: 15px; display: flex; flex-direction: column; gap: 15px; align-items: center; position: relative; background: rgba(255,255,255,0.5); }
        .cloud-label { font-weight: bold; color: #7f8c8d; font-size: 14px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* Service Slots */
        .service-slot { width: 240px; height: 60px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #ccc; font-weight: bold; font-size: 12px; position: relative; }
        
        .service-instance { width: 100%; height: 100%; background: #27ae60; color: white; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; font-size: 13px; position: absolute; top: 0; left: 0; cursor: pointer; border: 2px solid #219150; box-shadow: 0 4px 6px rgba(0,0,0,0.1); animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .service-instance.dead { display: none; } /* Simplified for this demo, usually we animate out */
        
        .instance-badge { background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px; font-size: 10px; }

        /* ANIMATION DOTS */
        .dot { width: 14px; height: 14px; border-radius: 50%; position: absolute; z-index: 100; display: none; border: 2px solid white; }
        .dot-reg { background: #f1c40f; box-shadow: 0 0 10px #f1c40f; } 
        .dot-req { background: #3498db; box-shadow: 0 0 10px #3498db; } 

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 30px; width: 700px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .control-label { font-weight: bold; color: #555; }
        
        .toggle-group { display: flex; gap: 10px; }
        
        /* Toggle Switches */
        .toggle-btn { padding: 8px 12px; border: 1px solid #ccc; background: #eee; cursor: pointer; border-radius: 4px; font-size: 12px; transition: 0.2s; color: #777; }
        .toggle-btn:hover { background: #ddd; }
        .toggle-btn.on { background: #27ae60; color: white; border-color: #219150; }
        .toggle-btn.off { background: #e74c3c; color: white; border-color: #c0392b; }

        .btn-call { background: #34495e; color: white; font-size: 16px; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-call:hover { background: #2c3e50; transform: translateY(-2px); }
        .btn-call:active { transform: translateY(0); }

        /* LOG */
        .log-display { font-family: monospace; color: #555; font-size: 13px; margin-top: 5px; min-height: 20px; }

        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 15px white; } 100% { transform: scale(1); } }
        .pulse-anim { animation: pulse 0.3s ease-in-out; }

    </style>
</head>
<body>

    <h1>Registry & Load Balancing Demo</h1>
    <p>Managing multiple instances of the same service.</p>

    <div class="layout">
        
        <div class="client-box" id="client">
            <div>üì± Client App</div>
            <div class="client-screen" id="client-log">
                > System Ready.
            </div>
        </div>

        <div class="registry-box" id="registry">
            <div class="registry-title">üìí Service Registry</div>
            <table class="registry-table">
                <thead>
                    <tr><th>Service ID</th><th>Address</th><th>Status</th></tr>
                </thead>
                <tbody id="reg-body">
                    <tr><td colspan="3" style="text-align:center; padding:20px; opacity:0.6;">Empty...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="cloud-zone">
            <div class="cloud-label">‚òÅÔ∏è Service Cluster</div>
            
            <div class="service-slot">
                <span style="opacity:0.3">Slot 1 (Port 8001)</span>
                <div id="svc-1" class="service-instance" style="display:none;">
                    <span>üì¶ Inventory</span>
                    <span class="instance-badge">8001</span>
                </div>
            </div>

            <div class="service-slot">
                <span style="opacity:0.3">Slot 2 (Port 8002)</span>
                <div id="svc-2" class="service-instance" style="display:none;">
                    <span>üì¶ Inventory</span>
                    <span class="instance-badge">8002</span>
                </div>
            </div>

            <div class="service-slot">
                <span style="opacity:0.3">Slot 3 (Port 8003)</span>
                <div id="svc-3" class="service-instance" style="display:none;">
                    <span>üì¶ Inventory</span>
                    <span class="instance-badge">8003</span>
                </div>
            </div>

        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        
        <div class="control-row">
            <div class="control-label">Manage Instances:</div>
            <div class="toggle-group">
                <button id="btn-1" class="toggle-btn" onclick="toggleService(1)">Start Node 1</button>
                <button id="btn-2" class="toggle-btn" onclick="toggleService(2)">Start Node 2</button>
                <button id="btn-3" class="toggle-btn" onclick="toggleService(3)">Start Node 3</button>
            </div>
        </div>

        <button class="btn-call" onclick="clientCall()">üìû Make Client Request</button>
        <div class="log-display" id="main-log">Waiting for user input...</div>
    </div>

    <script>
        // State
        const services = {
            1: { active: false, ip: '10.0.0.1', port: 8001 },
            2: { active: false, ip: '10.0.0.2', port: 8002 },
            3: { active: false, ip: '10.0.0.3', port: 8003 }
        };

        function toggleService(id) {
            const svc = services[id];
            const btn = document.getElementById(`btn-${id}`);
            const el = document.getElementById(`svc-${id}`);
            const regBox = document.getElementById('registry');

            if (!svc.active) {
                // START SERVICE
                svc.active = true;
                el.style.display = 'flex'; // Show Box
                btn.innerText = `Stop Node ${id}`;
                btn.className = "toggle-btn on";
                
                // Animate Registration
                log(`üöÄ Starting Service Node ${id}...`);
                animatePacket(el, regBox, 'dot-reg', () => {
                    updateRegistryUI();
                    log(`‚úÖ Node ${id} registered at ${svc.ip}:${svc.port}`);
                });

            } else {
                // STOP SERVICE
                svc.active = false;
                el.style.display = 'none'; // Hide Box
                btn.innerText = `Start Node ${id}`;
                btn.className = "toggle-btn"; // Reset to gray
                
                updateRegistryUI();
                log(`üõë Node ${id} stopped. Removed from Registry.`);
            }
        }

        function updateRegistryUI() {
            const tbody = document.getElementById('reg-body');
            tbody.innerHTML = "";
            
            const activeSvcs = Object.values(services).filter(s => s.active);

            if (activeSvcs.length === 0) {
                tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:20px; opacity:0.6;'>Empty...</td></tr>";
                return;
            }

            activeSvcs.forEach(s => {
                const row = `<tr><td>INVENTORY</td><td>:${s.port}</td><td class="status-up">UP</td></tr>`;
                tbody.innerHTML += row;
            });
        }

        function clientCall() {
            const clientLog = document.getElementById('client-log');
            const clientBox = document.getElementById('client');
            const registryBox = document.getElementById('registry');
            
            log("üîé Client Request initiated...");
            clientLog.innerHTML += "<br>> Calling Inventory...";
            clientLog.scrollTop = clientLog.scrollHeight; // Auto-scroll

            // 1. Client -> Registry
            animatePacket(clientBox, registryBox, 'dot-req', () => {
                
                // Get Active Services
                const activeSvcs = Object.values(services).filter(s => s.active);

                if (activeSvcs.length === 0) {
                    clientLog.innerHTML += "<br>> <span style='color:red'>ERR: Service Unavailable</span>";
                    log("‚ùå Call Failed: No active instances found in Registry.");
                    return;
                }

                // 2. Load Balancing Logic (Random)
                const target = activeSvcs[Math.floor(Math.random() * activeSvcs.length)];
                const targetEl = document.getElementById(`svc-${Object.keys(services).find(key => services[key] === target)}`);

                clientLog.innerHTML += `<br>> Registry: Try :${target.port}`;
                clientLog.scrollTop = clientLog.scrollHeight;

                // 3. Client -> Service Instance
                setTimeout(() => {
                    log(`üîÄ Load Balancer routing to Node Port ${target.port}...`);
                    animatePacket(clientBox, targetEl, 'dot-req', () => {
                        // Success Animation
                        targetEl.classList.add('pulse-anim');
                        setTimeout(() => targetEl.classList.remove('pulse-anim'), 300);
                        
                        clientLog.innerHTML += `<br>> <span style='color:#0f0'>SUCCESS: Data from :${target.port}</span>`;
                        clientLog.scrollTop = clientLog.scrollHeight;
                        log("‚úÖ Response received successfully.");
                    });
                }, 400);
            });
        }

        // --- ANIMATION UTILS ---
        function animatePacket(fromEl, toEl, dotClass, callback) {
            const dot = document.getElementById('dot');
            dot.className = `dot ${dotClass}`;
            dot.style.display = 'block';

            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();

            // Start
            dot.style.top = (fromRect.top + fromRect.height/2 - 7) + 'px';
            dot.style.left = (fromRect.left + fromRect.width/2 - 7) + 'px';
            dot.style.transition = 'none';
            
            void dot.offsetWidth; // Force Reflow

            // End
            dot.style.transition = 'all 0.6s ease-in-out';
            dot.style.top = (toRect.top + toRect.height/2 - 7) + 'px';
            dot.style.left = (toRect.left + toRect.width/2 - 7) + 'px';

            setTimeout(() => {
                dot.style.display = 'none';
                if(callback) callback();
            }, 600);
        }

        function log(msg) {
            document.getElementById('main-log').innerText = msg;
        }
    </script>
</body>
</html>












<!DOCTYPE html>
<html>
<head>
    <title>Service Registry: Multi-Service Demo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f7; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 30px; margin-top: 30px; align-items: flex-start; width: 1000px; justify-content: center; }
        
        /* BOX STYLES */
        .box { padding: 15px; border-radius: 8px; text-align: center; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: all 0.3s; }
        
        /* CLIENT */
        .client-box { width: 200px; background: #2c3e50; color: white; border: 4px solid #1a252f; min-height: 220px; display: flex; flex-direction: column; justify-content: flex-start; padding-top: 20px; z-index: 20; }
        .client-screen { background: #000; color: #0f0; margin: 10px; padding: 8px; font-family: monospace; font-size: 11px; height: 120px; overflow: hidden; border-radius: 4px; text-align: left; border: 1px solid #555; }

        /* REGISTRY (EUREKA) */
        .registry-box { width: 280px; background: #8e44ad; color: white; border: 4px solid #6c3483; min-height: 280px; z-index: 10; }
        .registry-title { font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; margin-bottom: 10px; }
        
        .registry-table { width: 100%; font-size: 11px; border-collapse: collapse; color: white; }
        .registry-table th { text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2); padding: 4px; }
        .registry-table td { padding: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .status-up { color: #2ecc71; font-weight: bold; }
        
        /* CLOUD ZONE (Services) */
        .cloud-zone { width: 280px; min-height: 380px; border: 3px dashed #bdc3c7; border-radius: 15px; padding: 15px; display: flex; flex-direction: column; gap: 15px; align-items: center; position: relative; background: rgba(255,255,255,0.5); }
        .cloud-label { font-weight: bold; color: #7f8c8d; font-size: 14px; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* Service Slots */
        .service-slot { width: 240px; height: 70px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #ccc; font-weight: bold; font-size: 12px; position: relative; }
        
        .service-instance { width: 100%; height: 100%; color: white; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; font-size: 13px; position: absolute; top: 0; left: 0; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .svc-pricing { background: #e67e22; border: 2px solid #d35400; }
        .svc-inventory { background: #27ae60; border: 2px solid #219150; }
        .svc-order { background: #2980b9; border: 2px solid #2471a3; }

        .instance-badge { background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 4px; font-size: 10px; font-family: monospace; }

        /* ANIMATION DOTS */
        .dot { width: 14px; height: 14px; border-radius: 50%; position: absolute; z-index: 100; display: none; border: 2px solid white; }
        .dot-reg { background: #f1c40f; box-shadow: 0 0 10px #f1c40f; } 
        .dot-req { background: #3498db; box-shadow: 0 0 10px #3498db; } 

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 30px; width: 800px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        
        .panel-row { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .panel-col { display: flex; flex-direction: column; gap: 10px; width: 48%; }
        
        h4 { margin: 0 0 10px 0; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        /* Buttons */
        button { padding: 10px 12px; border: 1px solid #ccc; background: #eee; cursor: pointer; border-radius: 4px; font-size: 12px; transition: 0.2s; color: #777; font-weight: bold; }
        button:hover { background: #ddd; }
        
        .btn-pricing.on { background: #e67e22; color: white; border-color: #d35400; }
        .btn-inventory.on { background: #27ae60; color: white; border-color: #219150; }
        .btn-order.on { background: #2980b9; color: white; border-color: #2471a3; }

        .btn-req { background: #34495e; color: white; border: none; font-size: 14px; padding: 10px; }
        .btn-req:hover { background: #2c3e50; }

        /* LOG */
        .log-display { font-family: monospace; color: #555; font-size: 13px; margin-top: 5px; min-height: 20px; }

        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 15px white; } 100% { transform: scale(1); } }
        .pulse-anim { animation: pulse 0.3s ease-in-out; }

    </style>
</head>
<body>

    <h1>Service Registry: Microservices Directory</h1>
    <p>The Client asks the Registry for a specific Service Type, and the Registry returns the correct address.</p>

    <div class="layout">
        
        <div class="client-box" id="client">
            <div>üì± Client App</div>
            <div class="client-screen" id="client-log">
                > System Ready.
            </div>
        </div>

        <div class="registry-box" id="registry">
            <div class="registry-title">üìí Registry (Phonebook)</div>
            <table class="registry-table">
                <thead>
                    <tr><th>Application Name</th><th>Location</th><th>Status</th></tr>
                </thead>
                <tbody id="reg-body">
                    <tr><td colspan="3" style="text-align:center; padding:20px; opacity:0.6;">Empty...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="cloud-zone">
            <div class="cloud-label">‚òÅÔ∏è Cloud Infrastructure</div>
            
            <div class="service-slot">
                <span style="opacity:0.3">Slot A</span>
                <div id="svc-pricing" class="service-instance svc-pricing" style="display:none;">
                    <span>üè∑Ô∏è Pricing Svc</span>
                    <span class="instance-badge">10.0.0.1</span>
                </div>
            </div>

            <div class="service-slot">
                <span style="opacity:0.3">Slot B</span>
                <div id="svc-inventory" class="service-instance svc-inventory" style="display:none;">
                    <span>üì¶ Inventory Svc</span>
                    <span class="instance-badge">10.0.0.2</span>
                </div>
            </div>

            <div class="service-slot">
                <span style="opacity:0.3">Slot C</span>
                <div id="svc-order" class="service-instance svc-order" style="display:none;">
                    <span>üõí Order Svc</span>
                    <span class="instance-badge">10.0.0.3</span>
                </div>
            </div>

        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <div class="panel-row">
            <div class="panel-col">
                <h4>1. Manage Services (Backend)</h4>
                <button id="btn-pricing" class="btn-pricing" onclick="toggleService('pricing')">Start Pricing Service</button>
                <button id="btn-inventory" class="btn-inventory" onclick="toggleService('inventory')">Start Inventory Service</button>
                <button id="btn-order" class="btn-order" onclick="toggleService('order')">Start Order Service</button>
            </div>
            <div class="panel-col">
                <h4>2. Client Actions (Frontend)</h4>
                <button class="btn-req" onclick="clientCall('pricing')">üè∑Ô∏è Get Product Price</button>
                <button class="btn-req" onclick="clientCall('inventory')">üì¶ Check Stock Level</button>
                <button class="btn-req" onclick="clientCall('order')">üõí Place New Order</button>
            </div>
        </div>
        <div class="log-display" id="main-log">Waiting for user input...</div>
    </div>

    <script>
        // State
        const services = {
            pricing: { active: false, ip: '10.0.0.1', port: 8081, name: 'PRICING-SVC' },
            inventory: { active: false, ip: '10.0.0.2', port: 8082, name: 'INVENTORY-SVC' },
            order: { active: false, ip: '10.0.0.3', port: 8083, name: 'ORDER-SVC' }
        };

        function toggleService(type) {
            const svc = services[type];
            const btn = document.getElementById(`btn-${type}`);
            const el = document.getElementById(`svc-${type}`);
            const regBox = document.getElementById('registry');

            if (!svc.active) {
                // START
                svc.active = true;
                el.style.display = 'flex';
                btn.innerText = `Stop ${svc.name}`;
                btn.classList.add('on');
                
                // Animate Registration
                log(`üöÄ ${svc.name} starting up...`);
                animatePacket(el, regBox, 'dot-reg', () => {
                    updateRegistryUI();
                    log(`‚úÖ ${svc.name} registered at ${svc.ip}`);
                });

            } else {
                // STOP
                svc.active = false;
                el.style.display = 'none';
                btn.innerText = `Start ${type.charAt(0).toUpperCase() + type.slice(1)} Service`;
                btn.classList.remove('on');
                
                updateRegistryUI();
                log(`üõë ${svc.name} shut down.`);
            }
        }

        function updateRegistryUI() {
            const tbody = document.getElementById('reg-body');
            tbody.innerHTML = "";
            
            const activeSvcs = Object.values(services).filter(s => s.active);

            if (activeSvcs.length === 0) {
                tbody.innerHTML = "<tr><td colspan='3' style='text-align:center; padding:20px; opacity:0.6;'>Empty...</td></tr>";
                return;
            }

            activeSvcs.forEach(s => {
                const row = `<tr><td>${s.name}</td><td>${s.ip}:${s.port}</td><td class="status-up">UP</td></tr>`;
                tbody.innerHTML += row;
            });
        }

        function clientCall(targetType) {
            const clientLog = document.getElementById('client-log');
            const clientBox = document.getElementById('client');
            const registryBox = document.getElementById('registry');
            const targetSvc = services[targetType];
            
            log(`üîé Client needs ${targetSvc.name}...`);
            clientLog.innerHTML += `<br>> Need: ${targetSvc.name}`;
            clientLog.scrollTop = clientLog.scrollHeight;

            // 1. Client -> Registry
            animatePacket(clientBox, registryBox, 'dot-req', () => {
                
                if (!targetSvc.active) {
                    clientLog.innerHTML += "<br>> <span style='color:red'>ERR: Not in Registry</span>";
                    log(`‚ùå Call Failed: Registry has no record of ${targetSvc.name}`);
                    return;
                }

                clientLog.innerHTML += `<br>> Found: ${targetSvc.ip}`;
                clientLog.scrollTop = clientLog.scrollHeight;

                const targetEl = document.getElementById(`svc-${targetType}`);

                // 2. Client -> Service Instance
                setTimeout(() => {
                    log(`üöÄ Connecting directly to ${targetSvc.ip}:${targetSvc.port}...`);
                    animatePacket(clientBox, targetEl, 'dot-req', () => {
                        // Success Animation
                        targetEl.classList.add('pulse-anim');
                        setTimeout(() => targetEl.classList.remove('pulse-anim'), 300);
                        
                        clientLog.innerHTML += `<br>> <span style='color:#0f0'>200 OK: Data Recvd</span>`;
                        clientLog.scrollTop = clientLog.scrollHeight;
                        log(`‚úÖ Success! Received response from ${targetSvc.name}`);
                    });
                }, 400);
            });
        }

        // --- ANIMATION UTILS ---
        function animatePacket(fromEl, toEl, dotClass, callback) {
            const dot = document.getElementById('dot');
            dot.className = `dot ${dotClass}`;
            dot.style.display = 'block';

            const fromRect = fromEl.getBoundingClientRect();
            const toRect = toEl.getBoundingClientRect();

            // Start
            dot.style.top = (fromRect.top + fromRect.height/2 - 7) + 'px';
            dot.style.left = (fromRect.left + fromRect.width/2 - 7) + 'px';
            dot.style.transition = 'none';
            
            void dot.offsetWidth; // Force Reflow

            // End
            dot.style.transition = 'all 0.6s ease-in-out';
            dot.style.top = (toRect.top + toRect.height/2 - 7) + 'px';
            dot.style.left = (toRect.left + toRect.width/2 - 7) + 'px';

            setTimeout(() => {
                dot.style.display = 'none';
                if(callback) callback();
            }, 600);
        }

        function log(msg) {
            document.getElementById('main-log').innerText = msg;
        }
    </script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
    <title>Circuit Breaker Pattern Demo (Fixed)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        .layout { display: flex; gap: 50px; margin-top: 40px; align-items: center; }
        
        /* BOXES */
        .box { width: 180px; height: 120px; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; transition: all 0.3s; }
        
        .client { background: #34495e; color: white; border-bottom: 5px solid #2c3e50; }
        
        /* SERVICE BOX */
        .service { background: #27ae60; color: white; border-bottom: 5px solid #219150; }
        .service.crashed { background: #c0392b; border-color: #922b21; animation: shake 0.5s; }

        /* CIRCUIT BREAKER (Middle) */
        .breaker { width: 160px; height: 160px; border-radius: 50%; border: 8px solid #ddd; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; font-size: 14px; position: relative; }
        
        .breaker.closed { border-color: #27ae60; color: #27ae60; }
        .breaker.open { border-color: #c0392b; color: #c0392b; }
        .breaker.half-open { border-color: #f1c40f; color: #f39c12; }

        .breaker-icon { font-size: 40px; margin-bottom: 5px; }
        .breaker-state { font-weight: 800; text-transform: uppercase; }
        .timer-display { font-size: 12px; color: #777; margin-top: 5px; height: 15px; }

        /* LINES */
        .line { width: 60px; height: 6px; background: #bdc3c7; }
        .line.active-success { background: #27ae60; }
        .line.active-fail { background: #c0392b; }

        /* DOT ANIMATION */
        .dot { width: 15px; height: 15px; border-radius: 50%; position: absolute; z-index: 100; display: none; }
        .dot-req { background: #3498db; box-shadow: 0 0 10px #3498db; }

        /* CONTROLS */
        .controls { background: white; padding: 25px; border-radius: 10px; margin-top: 50px; width: 600px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; }
        
        .btn-group { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; font-size: 14px; transition: 0.2s; color: white; }
        .btn-req { background: #3498db; width: 180px; }
        .btn-req:hover { background: #2980b9; }
        
        .btn-health { background: #27ae60; width: 180px; }
        .btn-health:hover { background: #219150; }
        .btn-health.dead { background: #c0392b; }
        .btn-health.dead:hover { background: #a93226; }

        /* LOG */
        .log-area { font-family: monospace; background: #eee; padding: 10px; border-radius: 5px; height: 100px; overflow-y: auto; text-align: left; font-size: 12px; border: 1px solid #ccc; }
        .log-err { color: #c0392b; }
        .log-warn { color: #d68910; }
        .log-succ { color: #27ae60; }

        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

    <h1>Circuit Breaker Pattern</h1>
    <p>States: üü¢ CLOSED (Normal) &rarr; üî¥ OPEN (Blocked) &rarr; üü° HALF-OPEN (Testing)</p>

    <div class="layout">
        
        <div class="box client" id="client-box">
            <span>üë§ User App</span>
        </div>

        <div class="line" id="line-1"></div>

        <div class="breaker closed" id="cb">
            <div class="breaker-icon" id="cb-icon">‚ö°</div>
            <div class="breaker-state" id="cb-state">CLOSED</div>
            <div class="timer-display" id="cb-timer">Failures: 0/3</div>
        </div>

        <div class="line" id="line-2"></div>

        <div class="box service" id="svc-box">
            <span id="svc-text">üì¶ Service<br>(Online)</span>
        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <div class="btn-group">
            <button class="btn-req" onclick="sendRequest()">üöÄ Send Request</button>
            <button class="btn-health" id="btn-health" onclick="toggleHealth()">‚úÖ Toggle Service Health</button>
        </div>
        
        <div class="log-area" id="log">System Ready...</div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const FAILURE_THRESHOLD = 3;
        const RESET_TIMEOUT_MS = 5000; // 5 Seconds wait time

        // --- STATE ---
        let state = 'CLOSED'; // CLOSED, OPEN, HALF_OPEN
        let failureCount = 0;
        let isServiceHealthy = true;
        let timerInterval = null;

        // --- UI UPDATES ---
        function updateUI() {
            const cb = document.getElementById('cb');
            const cbState = document.getElementById('cb-state');
            const cbTimer = document.getElementById('cb-timer');
            const cbIcon = document.getElementById('cb-icon');

            // Reset Classes
            cb.className = 'breaker';

            if (state === 'CLOSED') {
                cb.classList.add('closed');
                cbState.innerText = "CLOSED";
                cbIcon.innerText = "‚ö°";
                cbTimer.innerText = `Failures: ${failureCount}/${FAILURE_THRESHOLD}`;
            } 
            else if (state === 'OPEN') {
                cb.classList.add('open');
                cbState.innerText = "OPEN";
                cbIcon.innerText = "‚õî";
                // Timer text handled by countdown logic
            } 
            else if (state === 'HALF_OPEN') {
                cb.classList.add('half-open');
                cbState.innerText = "HALF-OPEN";
                cbIcon.innerText = "‚ö†Ô∏è";
                cbTimer.innerText = "Next request is a Probe";
            }
        }

        function toggleHealth() {
            isServiceHealthy = !isServiceHealthy;
            const svcBox = document.getElementById('svc-box');
            const btn = document.getElementById('btn-health');
            const svcText = document.getElementById('svc-text');

            if (isServiceHealthy) {
                svcBox.classList.remove('crashed');
                svcText.innerHTML = "üì¶ Service<br>(Online)";
                btn.classList.remove('dead');
                btn.innerText = "‚úÖ Service is Online";
                log("INFO: Service recovered. It is now HEALTHY.");
            } else {
                svcBox.classList.add('crashed');
                svcText.innerHTML = "üíÄ Service<br>(Crashed)";
                btn.classList.add('dead');
                btn.innerText = "‚ùå Service is Dead";
                log("WARN: Service has CRASHED.", "log-err");
            }
        }

        // --- CORE LOGIC ---
        function sendRequest() {
            if (state === 'OPEN') {
                log("BLOCKED: Circuit is OPEN. Request rejected immediately.", "log-err");
                return; // Fail Fast
            }

            // Animate Request
            animateRequest(() => {
                // HALF-OPEN LOGIC
                if (state === 'HALF_OPEN') {
                    log("PROBE: Sending test request to Service...", "log-warn");
                    
                    if (isServiceHealthy) {
                        // SUCCESS: Close the circuit
                        state = 'CLOSED';
                        failureCount = 0;
                        log("SUCCESS: Service response received! Circuit CLOSED.", "log-succ");
                    } else {
                        // FAILURE: Re-open the circuit
                        state = 'OPEN';
                        log("FAILURE: Service still dead. Circuit Re-OPENED.", "log-err");
                        startOpenTimer();
                    }
                    updateUI();
                    return;
                }

                // CLOSED LOGIC
                if (isServiceHealthy) {
                    log("SUCCESS: 200 OK - Data received.", "log-succ");
                    failureCount = 0; // Reset consecutive failures on success
                } else {
                    failureCount++;
                    log(`ERROR: 500 Server Error (Count: ${failureCount})`, "log-err");
                    
                    if (failureCount >= FAILURE_THRESHOLD) {
                        tripCircuit();
                    }
                }
                updateUI();
            });
        }

        function tripCircuit() {
            state = 'OPEN';
            log("!!! THRESHOLD REACHED. Circuit TRIPPED to OPEN !!!", "log-err");
            updateUI();
            startOpenTimer();
        }

        function startOpenTimer() {
            let timeLeft = RESET_TIMEOUT_MS / 1000;
            const timerDisplay = document.getElementById('cb-timer');
            
            // Clear any existing timer
            if(timerInterval) clearInterval(timerInterval);

            timerDisplay.innerText = `Reset in ${timeLeft}s...`;

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = `Reset in ${timeLeft}s...`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    state = 'HALF_OPEN';
                    updateUI();
                    log("TIMEOUT: Cooldown finished. Circuit switched to HALF-OPEN.", "log-warn");
                }
            }, 1000);
        }

        // --- ANIMATION ---
        function animateRequest(callback) {
            const dot = document.getElementById('dot');
            const client = document.getElementById('client-box');
            const cb = document.getElementById('cb');
            const svc = document.getElementById('svc-box');

            // 1. Client -> CB
            moveDot(client, cb, () => {
                // If Open, stop here
                if (state === 'OPEN') {
                    dot.style.display = 'none';
                    return; 
                }

                // 2. CB -> Service
                moveDot(cb, svc, () => {
                    dot.style.display = 'none';
                    callback();
                });
            });
        }

        function moveDot(fromEl, toEl, cb) {
            const dot = document.getElementById('dot');
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            dot.style.display = 'block';
            dot.style.top = (f.top + f.height/2 - 7) + 'px';
            dot.style.left = (f.left + f.width/2 - 7) + 'px';
            dot.style.transition = 'none';
            void dot.offsetWidth; // Force Reflow

            dot.style.transition = 'all 0.4s linear';
            dot.style.top = (t.top + t.height/2 - 7) + 'px';
            dot.style.left = (t.left + t.width/2 - 7) + 'px';

            setTimeout(cb, 400);
        }

        function log(msg, cls = "") {
            const div = document.getElementById('log');
            div.innerHTML = `<div class="${cls}">> ${msg}</div>` + div.innerHTML;
        }

        // Init
        updateUI();

    </script>
</body>
</html>




<!DOCTYPE html>
<html>
<head>
    <title>Saga Pattern Simulator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; flex-direction: column; align-items: center; margin-top: 40px; width: 900px; }
        
        /* ORCHESTRATOR */
        .orchestrator { width: 120px; height: 120px; background: #f39c12; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 0 20px rgba(243, 156, 18, 0.4); z-index: 10; margin-bottom: 40px; border: 4px solid #e67e22; font-size: 12px; text-align: center; }
        
        /* SERVICE ROW */
        .service-row { display: flex; gap: 40px; width: 100%; justify-content: center; position: relative; }
        
        .service-box { width: 160px; height: 120px; background: #34495e; border-radius: 8px; border: 3px solid #7f8c8d; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.5s; position: relative; }
        
        .service-icon { font-size: 30px; margin-bottom: 5px; }
        .service-name { font-weight: bold; font-size: 14px; }
        .status-badge { margin-top: 8px; font-size: 11px; padding: 4px 8px; border-radius: 4px; background: #222; min-width: 80px; text-align: center; }

        /* STATES */
        .service-box.success { border-color: #2ecc71; box-shadow: 0 0 15px rgba(46, 204, 113, 0.5); }
        .service-box.success .status-badge { background: #2ecc71; color: white; }

        .service-box.error { border-color: #e74c3c; box-shadow: 0 0 15px rgba(231, 76, 60, 0.5); }
        .service-box.error .status-badge { background: #e74c3c; color: white; }

        .service-box.compensated { border-color: #f39c12; background: #4a3b2a; }
        .service-box.compensated .status-badge { background: #f39c12; color: #222; font-weight: bold; }

        /* CONNECTIONS */
        .connector-line { position: absolute; height: 4px; background: #555; top: 50%; z-index: 0; width: 80%; transform: translateY(-50%); }

        /* ANIMATION DOTS */
        .dot { width: 16px; height: 16px; border-radius: 50%; position: absolute; z-index: 100; display: none; transition: all 0.5s linear; }
        .dot-forward { background: #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .dot-backward { background: #e74c3c; box-shadow: 0 0 10px #e74c3c; }

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 50px; width: 700px; color: #333; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .btn-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
        
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; font-size: 14px; transition: 0.2s; color: white; }
        
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #219150; }

        .btn-fail-pay { background: #c0392b; }
        .btn-fail-inv { background: #e67e22; }
        .btn-fail-dlv { background: #8e44ad; }

        /* LOG */
        .log-area { font-family: monospace; background: #eee; padding: 10px; border-radius: 5px; height: 120px; overflow-y: auto; text-align: left; font-size: 12px; border: 1px solid #ccc; color: #333; }
        .log-step { color: #2ecc71; }
        .log-err { color: #e74c3c; font-weight: bold; }
        .log-undo { color: #f39c12; font-weight: bold; }

    </style>
</head>
<body>

    <h1>Saga Pattern Simulator</h1>
    <p>Managing Distributed Transactions using Compensation (Rollback)</p>

    <div class="layout">
        
        <div class="orchestrator" id="orch">
            <span>SAGA<br>ORCHESTRATOR</span>
        </div>

        <div class="service-row">
            <div class="connector-line"></div>

            <div class="service-box" id="svc-order">
                <div class="service-icon">üìù</div>
                <div class="service-name">Order Service</div>
                <div class="status-badge" id="status-order">Pending</div>
            </div>

            <div class="service-box" id="svc-pay">
                <div class="service-icon">üí≥</div>
                <div class="service-name">Payment</div>
                <div class="status-badge" id="status-pay">Pending</div>
            </div>

            <div class="service-box" id="svc-inv">
                <div class="service-icon">üì¶</div>
                <div class="service-name">Inventory</div>
                <div class="status-badge" id="status-inv">Pending</div>
            </div>

            <div class="service-box" id="svc-ship">
                <div class="service-icon">üöö</div>
                <div class="service-name">Delivery</div>
                <div class="status-badge" id="status-ship">Pending</div>
            </div>
        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <h3>Simulate User Journey</h3>
        <div class="btn-group">
            <button class="btn-success" onclick="runSaga('success')">‚úÖ Happy Path (Success)</button>
            <button class="btn-fail-inv" onclick="runSaga('fail-inv')">‚ö†Ô∏è Fail at Inventory (No Stock)</button>
            <button class="btn-fail-dlv" onclick="runSaga('fail-dlv')">üõë Fail at Delivery (Bad Address)</button>
        </div>
        
        <div class="log-area" id="log">System Ready...</div>
    </div>

    <script>
        const services = ['order', 'pay', 'inv', 'ship'];
        let failAt = '';
        let isCompensating = false;

        function runSaga(scenario) {
            // Reset
            failAt = scenario;
            isCompensating = false;
            document.getElementById('log').innerHTML = "Starting New Transaction...";
            services.forEach(s => {
                const box = document.getElementById(`svc-${s}`);
                const badge = document.getElementById(`status-${s}`);
                box.className = 'service-box';
                badge.innerText = 'Pending';
            });

            // Start Step 1
            log("Saga Started: Transaction ID #101 created.");
            executeStep(0);
        }

        function executeStep(index) {
            if (index >= services.length) {
                log("üéâ SAGA COMPLETED SUCCESSFULLY!", "log-step");
                return;
            }

            const svcId = services[index];
            const box = document.getElementById(`svc-${svcId}`);
            const badge = document.getElementById(`status-${svcId}`);
            const orchestrator = document.getElementById('orch');

            // Animate Packet (Orchestrator -> Service)
            moveDot(orchestrator, box, 'dot-forward', () => {
                
                // CHECK FOR FAILURE SIMULATION
                if (
                    (failAt === 'fail-inv' && svcId === 'inv') || 
                    (failAt === 'fail-dlv' && svcId === 'ship')
                ) {
                    // FAILURE!
                    box.classList.add('error');
                    badge.innerText = "FAILED";
                    log(`‚ùå ERROR at ${getServiceName(svcId)}. Triggering Rollback...`, "log-err");
                    
                    setTimeout(() => startCompensation(index - 1), 1000);
                    return;
                }

                // SUCCESS
                box.classList.add('success');
                badge.innerText = getActionName(svcId);
                log(`‚úÖ ${getServiceName(svcId)}: Success.`, "log-step");

                // Move to next step
                setTimeout(() => executeStep(index + 1), 800);
            });
        }

        function startCompensation(index) {
            isCompensating = true;
            log("üîÑ ROLLBACK STARTED: Undoing previous steps...", "log-undo");
            compensateStep(index);
        }

        function compensateStep(index) {
            if (index < 0) {
                log("üõë ROLLBACK COMPLETE: System state is consistent.", "log-undo");
                document.getElementById('svc-order').classList.add('compensated');
                document.getElementById('status-order').innerText = "CANCELLED";
                return;
            }

            const svcId = services[index];
            const box = document.getElementById(`svc-${svcId}`);
            const badge = document.getElementById(`status-${svcId}`);
            const orchestrator = document.getElementById('orch');

            // Animate Packet (Orchestrator -> Service) -> RED DOT
            moveDot(orchestrator, box, 'dot-backward', () => {
                
                box.classList.remove('success');
                box.classList.add('compensated');
                badge.innerText = getCompensateName(svcId);
                log(`‚Ü©Ô∏è COMPENSATING ${getServiceName(svcId)}: ${getCompensateName(svcId)}`, "log-undo");

                // Move backwards
                setTimeout(() => compensateStep(index - 1), 1000);
            });
        }

        // --- UTILS ---
        function getServiceName(id) {
            const map = { 'order': 'Order Svc', 'pay': 'Payment Svc', 'inv': 'Inventory Svc', 'ship': 'Delivery Svc' };
            return map[id];
        }

        function getActionName(id) {
            const map = { 'order': 'CREATED', 'pay': 'CHARGED', 'inv': 'RESERVED', 'ship': 'SCHEDULED' };
            return map[id];
        }

        function getCompensateName(id) {
            const map = { 'order': 'CANCELLED', 'pay': 'REFUNDED', 'inv': 'RESTOCKED', 'ship': 'CANCELLED' };
            return map[id];
        }

        function moveDot(fromEl, toEl, dotClass, callback) {
            const dot = document.getElementById('dot');
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            dot.className = `dot ${dotClass}`;
            dot.style.display = 'block';
            dot.style.top = (f.top + f.height/2 - 8) + 'px';
            dot.style.left = (f.left + f.width/2 - 8) + 'px';
            dot.style.transition = 'none';
            void dot.offsetWidth;

            dot.style.transition = 'all 0.6s ease-in-out';
            dot.style.top = (t.top + t.height/2 - 8) + 'px';
            dot.style.left = (t.left + t.width/2 - 8) + 'px';

            setTimeout(() => {
                dot.style.display = 'none';
                callback();
            }, 600);
        }

        function log(msg, cls="") {
            const div = document.getElementById('log');
            div.innerHTML = `<div class="${cls}">${msg}</div>` + div.innerHTML;
        }
    </script>
</body>
</html>






<!DOCTYPE html>
<html>
<head>
    <title>Choreography Saga: IRCTC Tatkal</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #1e1e2e; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { position: relative; width: 900px; height: 500px; margin-top: 20px; }
        
        /* EVENT BUS (KAFKA) */
        .event-bus-container { width: 100%; height: 60px; background: #333; border-radius: 30px; border: 2px dashed #666; position: absolute; top: 0; display: flex; align-items: center; justify-content: center; z-index: 0; }
        .event-bus-label { color: #888; font-weight: bold; letter-spacing: 2px; font-size: 14px; background: #1e1e2e; padding: 0 10px; }

        /* SERVICES */
        .service-row { display: flex; justify-content: space-between; width: 100%; position: absolute; bottom: 0; }
        
        .service { width: 180px; height: 140px; background: #2c2c3e; border: 2px solid #444; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        .svc-icon { font-size: 30px; margin-bottom: 10px; }
        .svc-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
        .svc-status { font-size: 11px; padding: 3px 8px; border-radius: 4px; background: #111; min-width: 80px; text-align: center; color: #aaa; transition: 0.3s; }

        /* SPECIFIC COLORS */
        .svc-booking { border-bottom: 4px solid #3498db; }
        .svc-seat { border-bottom: 4px solid #f1c40f; }
        .svc-pay { border-bottom: 4px solid #e74c3c; }
        .svc-notify { border-bottom: 4px solid #2ecc71; }

        /* STATES */
        .active { box-shadow: 0 0 20px rgba(255,255,255,0.2); background: #3a3a4e; }
        .success .svc-status { background: #2ecc71; color: #fff; }
        .error .svc-status { background: #e74c3c; color: #fff; }
        .rollback .svc-status { background: #e67e22; color: #fff; }

        /* CONNECTOR LINES (Vertical pipes to bus) */
        .pipe { position: absolute; width: 4px; background: #444; top: 60px; bottom: 140px; z-index: -1; }
        
        /* MESSAGE DOTS */
        .packet { width: 14px; height: 14px; border-radius: 50%; position: absolute; z-index: 100; display: none; box-shadow: 0 0 10px white; }
        .pkg-event { background: #f1c40f; } /* Event Color */
        .pkg-err { background: #e74c3c; }   /* Error Event Color */

        /* EVENT BUBBLE (The Toast) */
        .event-bubble { position: absolute; top: 70px; background: #fff; color: #333; padding: 5px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; opacity: 0; transition: opacity 0.3s; pointer-events: none; white-space: nowrap; }

        /* CONTROLS */
        .controls { background: #fff; padding: 20px; border-radius: 10px; margin-top: 20px; width: 700px; color: #333; text-align: center; }
        .btn-group { display: flex; justify-content: center; gap: 20px; margin-bottom: 10px; }
        
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; color: white; transition: 0.2s; }
        .btn-success { background: #2ecc71; }
        .btn-success:hover { background: #27ae60; }
        .btn-fail { background: #e74c3c; }
        .btn-fail:hover { background: #c0392b; }

        #log { font-family: monospace; font-size: 12px; color: #555; margin-top: 10px; min-height: 20px; }

    </style>
</head>
<body>

    <h1>IRCTC Choreography Saga</h1>
    <p>Decoupled Architecture: Services react to events on the Message Bus.</p>

    <div class="layout">
        
        <div class="event-bus-container">
            <span class="event-bus-label">‚ö° MESSAGE BROKER (KAFKA) ‚ö°</span>
        </div>

        <div class="pipe" style="left: 100px;"></div> <div class="pipe" style="left: 340px;"></div> <div class="pipe" style="left: 580px;"></div> <div class="pipe" style="left: 820px;"></div> <div class="service-row">
            <div class="service svc-booking" id="svc-booking">
                <div class="svc-icon">üöÜ</div>
                <div class="svc-name">Booking Svc</div>
                <div class="svc-status" id="st-booking">Idle</div>
            </div>

            <div class="service svc-seat" id="svc-seat">
                <div class="svc-icon">üí∫</div>
                <div class="svc-name">Seat Alloc. Svc</div>
                <div class="svc-status" id="st-seat">Idle</div>
            </div>

            <div class="service svc-pay" id="svc-pay">
                <div class="svc-icon">üí≥</div>
                <div class="svc-name">Payment Svc</div>
                <div class="svc-status" id="st-pay">Idle</div>
            </div>

            <div class="service svc-notify" id="svc-notify">
                <div class="svc-icon">üì©</div>
                <div class="svc-name">Notification Svc</div>
                <div class="svc-status" id="st-notify">Idle</div>
            </div>
        </div>

        <div id="packet" class="packet"></div>
        <div id="evt-lbl" class="event-bubble">Event Name</div>

    </div>

    <div class="controls">
        <div class="btn-group">
            <button class="btn-success" onclick="startFlow(true)">‚úÖ Happy Path (Ticket Confirmed)</button>
            <button class="btn-fail" onclick="startFlow(false)">‚ö†Ô∏è Payment Failure (Rollback)</button>
        </div>
        <div id="log">Waiting for user input...</div>
    </div>

    <script>
        // Coordinates for pipes (approximate centers of services)
        const POS = {
            booking: 100,
            seat: 340,
            pay: 580,
            notify: 820,
            busY: 30,    // Top of bus
            svcY: 360    // Top of service box
        };

        function reset() {
            document.querySelectorAll('.service').forEach(el => {
                el.className = el.className.split(' ')[0] + ' service'; // keep base class
                el.querySelector('.svc-status').innerText = 'Idle';
            });
            document.getElementById('log').innerText = "Starting Transaction...";
        }

        function startFlow(isSuccess) {
            reset();
            
            // Step 1: User creates Booking
            updateStatus('booking', 'PENDING', 'active');
            log("User clicks 'Book'. Booking Service creates Record.");

            // Event: BOOKING_CREATED -> Goes to Seat Svc
            setTimeout(() => {
                emitEvent('booking', 'seat', 'BOOKING_CREATED', false, () => {
                    // Step 2: Seat Allocation
                    updateStatus('seat', 'RESERVED', 'success');
                    log("Seat Service reserves Berth S7-42.");

                    // Event: SEAT_RESERVED -> Goes to Payment Svc
                    setTimeout(() => {
                        emitEvent('seat', 'pay', 'SEAT_RESERVED', false, () => {
                            // Step 3: Payment
                            if (isSuccess) {
                                // HAPPY PATH
                                updateStatus('pay', 'PAID', 'success');
                                log("Payment Service charges ‚Çπ1200.");

                                // Event: PAYMENT_SUCCESS -> Goes to Notification
                                setTimeout(() => {
                                    emitEvent('pay', 'notify', 'PAYMENT_SUCCESS', false, () => {
                                        updateStatus('notify', 'SENT', 'success');
                                        updateStatus('booking', 'CONFIRMED', 'success');
                                        log("üéâ Ticket SMS Sent! Booking Confirmed.");
                                    });
                                }, 800);

                            } else {
                                // FAILURE PATH
                                updateStatus('pay', 'FAILED', 'error');
                                log("‚ùå Payment Failed (Bank Timeout).");

                                // Event: PAYMENT_FAILED -> Goes back to Seat & Booking
                                setTimeout(() => {
                                    log("üì¢ Publishing PAYMENT_FAILED event...");
                                    
                                    // 1. Notify Seat Service to Rollback
                                    emitEvent('pay', 'seat', 'PAYMENT_FAILED', true, () => {
                                        updateStatus('seat', 'RELEASED', 'rollback');
                                        log("‚Ü©Ô∏è Seat Service compensates: Berth released.");
                                        
                                        // 2. Notify Booking Service to Cancel
                                        setTimeout(() => {
                                            emitEvent('seat', 'booking', 'SEAT_RELEASED', true, () => {
                                                updateStatus('booking', 'CANCELLED', 'rollback');
                                                log("üõë Booking Service compensates: Status set to CANCELLED.");
                                            });
                                        }, 800);
                                    });
                                }, 800);
                            }
                        });
                    }, 800);
                });
            }, 800);
        }

        // --- ANIMATION LOGIC ---
        function emitEvent(from, to, eventName, isError, callback) {
            const pkt = document.getElementById('packet');
            const lbl = document.getElementById('evt-lbl');
            
            // Color setup
            pkt.className = 'packet ' + (isError ? 'pkg-err' : 'pkg-event');
            pkt.style.display = 'block';
            
            // Set Label
            lbl.innerText = eventName;
            lbl.style.color = isError ? '#e74c3c' : '#333';
            lbl.style.left = (POS[from] - 40) + 'px';
            lbl.style.opacity = 1;

            // 1. UP to Bus
            animate(pkt, POS[from], POS.svcY, POS[from], POS.busY, 400, () => {
                
                // 2. ACROSS Bus
                animate(pkt, POS[from], POS.busY, POS[to], POS.busY, 600, () => {
                    
                    // Move Label
                    lbl.style.left = (POS[to] - 40) + 'px';

                    // 3. DOWN to Service
                    animate(pkt, POS[to], POS.busY, POS[to], POS.svcY, 400, () => {
                        pkt.style.display = 'none';
                        lbl.style.opacity = 0;
                        if(callback) callback();
                    });
                });
            });
        }

        function animate(el, x1, y1, x2, y2, duration, cb) {
            const start = performance.now();
            
            function step(timestamp) {
                const progress = Math.min((timestamp - start) / duration, 1);
                
                const curX = x1 + (x2 - x1) * progress;
                const curY = y1 + (y2 - y1) * progress;
                
                el.style.left = curX + 'px';
                el.style.top = curY + 'px';

                if (progress < 1) {
                    requestAnimationFrame(step);
                } else {
                    cb();
                }
            }
            requestAnimationFrame(step);
        }

        function updateStatus(id, text, type) {
            const el = document.getElementById('svc-' + id);
            const badge = document.getElementById('st-' + id);
            
            // Reset classes
            el.classList.remove('active', 'success', 'error', 'rollback');
            el.classList.add(type);
            
            badge.innerText = text;
            
            // Pulse animation
            el.style.transform = "scale(1.1)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }

        function log(msg) {
            document.getElementById('log').innerText = "> " + msg;
        }

    </script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
    <title>CQRS Pattern Simulator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; gap: 50px; margin-top: 40px; align-items: flex-start; width: 900px; justify-content: center; }
        
        /* COLUMNS */
        .column { display: flex; flex-direction: column; align-items: center; width: 300px; position: relative; }
        
        /* DATABASES */
        .db { width: 120px; height: 140px; border-radius: 50%/20px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.3s; }
        .db::before { content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px; border-radius: 50%; border: inherit; background: inherit; filter: brightness(1.2); }
        
        .db-write { background: #c0392b; border: 4px solid #922b21; color: white; } /* Red for Command */
        .db-read { background: #27ae60; border: 4px solid #1e8449; color: white; }  /* Green for Query */

        .db-data { font-family: monospace; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px; margin-top: 10px; }

        /* USERS */
        .user-box { width: 100%; background: #34495e; border-radius: 8px; padding: 15px; text-align: center; border: 2px solid #555; min-height: 180px; }
        .user-title { font-weight: bold; margin-bottom: 10px; display: block; border-bottom: 1px solid #555; padding-bottom: 5px; }
        
        /* SYNC PIPE */
        .sync-arrow { position: absolute; top: 70px; left: 180px; width: 440px; height: 10px; background: #555; z-index: 0; }
        .sync-label { position: absolute; top: 40px; left: 350px; color: #aaa; font-size: 12px; }

        /* PACKET */
        .packet { width: 20px; height: 20px; background: #f1c40f; border-radius: 50%; position: absolute; top: 65px; left: 150px; display: none; box-shadow: 0 0 10px #f1c40f; z-index: 100; }

        /* INPUTS */
        input { padding: 8px; border-radius: 4px; border: none; width: 80px; text-align: center; }
        button { padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; margin-top: 10px; transition: 0.2s; color: white; }
        
        .btn-update { background: #e67e22; }
        .btn-update:hover { background: #d35400; }

        .btn-refresh { background: #3498db; }
        .btn-refresh:hover { background: #2980b9; }

        /* DISPLAY */
        .price-display { font-size: 24px; font-weight: bold; color: #2ecc71; margin: 15px 0; }
        .status-msg { font-size: 12px; color: #ccc; min-height: 20px; }

    </style>
</head>
<body>

    <h1>CQRS Pattern Simulator</h1>
    <p>Command (Write) vs. Query (Read) Responsibility Segregation</p>

    <div class="layout">
        
        <div class="column">
            <h3>COMMAND SIDE</h3>
            <div class="db db-write" id="db-write">
                <div>WRITE DB</div>
                <div class="db-data" id="val-write">$100</div>
            </div>
            
            <div class="user-box">
                <span class="user-title">üë§ ADMIN PANEL</span>
                <p>Update Product Price</p>
                <input type="number" id="price-input" value="150">
                <br>
                <button class="btn-update" onclick="updatePrice()">Update Price</button>
                <div class="status-msg" id="msg-admin"></div>
            </div>
        </div>

        <div class="sync-arrow"></div>
        <div class="sync-label">Eventual Consistency (Sync Bus)</div>
        <div id="packet" class="packet"></div>

        <div class="column" style="left: 100px;">
            <h3>QUERY SIDE</h3>
            <div class="db db-read" id="db-read">
                <div>READ DB</div>
                <div class="db-data" id="val-read">$100</div>
            </div>

            <div class="user-box">
                <span class="user-title">üõí CUSTOMER VIEW</span>
                <p>Viewing "MacBook Pro"</p>
                <div class="price-display" id="cust-price">$100</div>
                <button class="btn-refresh" onclick="refreshPage()">üîÑ Refresh Page</button>
                <div class="status-msg" id="msg-cust">Data source: Read DB</div>
            </div>
        </div>

    </div>

    <script>
        let writePrice = 100;
        let readPrice = 100;
        let isSyncing = false;

        function updatePrice() {
            const inputVal = document.getElementById('price-input').value;
            
            // 1. Update Command DB Instantly
            writePrice = inputVal;
            document.getElementById('val-write').innerText = "$" + writePrice;
            document.getElementById('msg-admin').innerText = "Saved to Write DB!";
            document.getElementById('msg-admin').style.color = "#e67e22";

            // Visual Pulse
            pulse(document.getElementById('db-write'));

            // 2. Trigger Async Sync
            if(!isSyncing) {
                isSyncing = true;
                setTimeout(syncData, 1000); // 1 Second Delay to simulate lag
            }
        }

        function syncData() {
            const packet = document.getElementById('packet');
            const startX = 150;
            const endX = 600; // Distance to Read DB

            packet.style.display = 'block';
            packet.style.left = startX + 'px';

            // Animate Packet
            let pos = startX;
            const interval = setInterval(() => {
                pos += 5;
                packet.style.left = pos + 'px';

                if (pos >= endX) {
                    clearInterval(interval);
                    packet.style.display = 'none';
                    
                    // Update Read DB
                    readPrice = writePrice;
                    document.getElementById('val-read').innerText = "$" + readPrice;
                    pulse(document.getElementById('db-read'));
                    isSyncing = false;
                }
            }, 10);
        }

        function refreshPage() {
            // Customer reads ONLY from Read DB
            document.getElementById('cust-price').innerText = "$" + readPrice;
            
            const msg = document.getElementById('msg-cust');
            
            if (readPrice != writePrice) {
                msg.innerText = "‚ö†Ô∏è STALE DATA! (Sync pending)";
                msg.style.color = "#f1c40f";
            } else {
                msg.innerText = "‚úÖ Fresh Data (Synced)";
                msg.style.color = "#2ecc71";
            }
        }

        function pulse(el) {
            el.style.transform = "scale(1.1)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }
    </script>
</body>
</html>







<!DOCTYPE html>
<html>
<head>
    <title>CQRS Pattern Simulator (Fixed)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        /* Main Layout Container - Fixed width for stability */
        .layout { 
            position: relative; /* Anchor for absolute children */
            display: flex; 
            justify-content: space-between; /* Push columns to edges */
            width: 800px; 
            margin-top: 50px; 
        }
        
        /* COLUMNS */
        .column { display: flex; flex-direction: column; align-items: center; width: 300px; z-index: 2; }
        
        /* DATABASES */
        .db { width: 120px; height: 140px; border-radius: 50%/20px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.2s; background-color: #333; }
        .db::before { content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px; border-radius: 50%; border: inherit; background: inherit; filter: brightness(1.2); }
        
        .db-write { background: #c0392b; border: 4px solid #922b21; color: white; } /* Red */
        .db-read { background: #27ae60; border: 4px solid #1e8449; color: white; }  /* Green */

        .db-data { font-family: monospace; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px; margin-top: 10px; }

        /* SYNC PIPE (The Bus) */
        .sync-pipe-container {
            position: absolute;
            top: 70px; /* Vertically align with center of DBs (140px height / 2) */
            left: 150px; /* Start at center of Col 1 (300px / 2) */
            width: 500px; /* Span to center of Col 2 */
            height: 12px;
            z-index: 0; /* Behind DBs */
        }

        .sync-pipe-line {
            width: 100%;
            height: 100%;
            background: #555;
            border-radius: 6px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        .sync-label {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            color: #aaa;
            font-size: 12px;
            letter-spacing: 1px;
            font-weight: bold;
        }

        /* PACKET (The Event) */
        .packet { 
            width: 24px; 
            height: 24px; 
            background: #f1c40f; 
            border: 2px solid white;
            border-radius: 50%; 
            position: absolute; 
            top: -6px; /* Center on pipe height (12px) */
            left: 0; 
            display: none; 
            box-shadow: 0 0 15px #f1c40f; 
            z-index: 5; 
        }

        /* USER INTERFACE BOXES */
        .user-box { width: 100%; background: #34495e; border-radius: 8px; padding: 15px; text-align: center; border: 2px solid #555; min-height: 180px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .user-title { font-weight: bold; margin-bottom: 10px; display: block; border-bottom: 1px solid #555; padding-bottom: 5px; color: #ccc; letter-spacing: 1px; font-size: 12px; }
        
        input { padding: 10px; border-radius: 4px; border: none; width: 100px; text-align: center; font-weight: bold; font-size: 16px; }
        
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; margin-top: 15px; transition: 0.2s; color: white; width: 80%; }
        
        .btn-update { background: #e67e22; }
        .btn-update:hover { background: #d35400; }

        .btn-refresh { background: #3498db; }
        .btn-refresh:hover { background: #2980b9; }

        /* DISPLAY TEXT */
        .price-display { font-size: 32px; font-weight: bold; color: #2ecc71; margin: 15px 0; }
        .status-msg { font-size: 13px; color: #ccc; min-height: 20px; margin-top: 10px; font-family: monospace; }

        /* ANIMATION UTILS */
        .pulse { animation: pulse 0.3s ease-in-out; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <h1>CQRS Pattern Simulator</h1>
    <p>Visualizing <b>Eventual Consistency</b> (The delay between Write and Read)</p>

    <div class="layout">
        
        <div class="sync-pipe-container">
            <div class="sync-label">‚ö° EVENT BUS (SYNC) ‚ö°</div>
            <div class="sync-pipe-line"></div>
            <div id="packet" class="packet"></div>
        </div>

        <div class="column">
            <h3>COMMAND (Write)</h3>
            <div class="db db-write" id="db-write">
                <div style="margin-top:15px">MASTER DB</div>
                <div class="db-data" id="val-write">$100</div>
            </div>
            
            <div class="user-box">
                <span class="user-title">üë§ ADMIN PANEL</span>
                <p>Change Product Price</p>
                <input type="number" id="price-input" value="150">
                <br>
                <button class="btn-update" onclick="updatePrice()">Update Price</button>
                <div class="status-msg" id="msg-admin">System Ready.</div>
            </div>
        </div>

        <div class="column">
            <h3>QUERY (Read)</h3>
            <div class="db db-read" id="db-read">
                <div style="margin-top:15px">READ DB</div>
                <div class="db-data" id="val-read">$100</div>
            </div>

            <div class="user-box">
                <span class="user-title">üõí CUSTOMER APP</span>
                <p>User Viewing Item</p>
                <div class="price-display" id="cust-price">$100</div>
                <button class="btn-refresh" onclick="refreshPage()">üîÑ Refresh Page</button>
                <div class="status-msg" id="msg-cust">Data source: Read DB</div>
            </div>
        </div>

    </div>

    <script>
        let writePrice = 100;
        let readPrice = 100;
        let isSyncing = false;

        function updatePrice() {
            const inputVal = document.getElementById('price-input').value;
            
            // 1. Update Command DB Instantly
            writePrice = inputVal;
            document.getElementById('val-write').innerText = "$" + writePrice;
            
            const msgAdmin = document.getElementById('msg-admin');
            msgAdmin.innerText = "Saved to Write DB!";
            msgAdmin.style.color = "#e67e22";

            // Visual Pulse for DB
            const dbWrite = document.getElementById('db-write');
            dbWrite.classList.remove('pulse');
            void dbWrite.offsetWidth; // trigger reflow
            dbWrite.classList.add('pulse');

            // 2. Trigger Async Sync (with delay)
            if(!isSyncing) {
                isSyncing = true;
                // Start animation after a short delay to simulate "processing"
                setTimeout(startSyncAnimation, 500); 
            }
        }

        function startSyncAnimation() {
            const packet = document.getElementById('packet');
            const containerWidth = 500; // Width of sync-pipe-container
            const packetSize = 24;
            
            packet.style.display = 'block';
            packet.style.left = '0px';

            let pos = 0;
            // Slower animation to allow time for "Stale Data" demo
            const speed = 3; 
            
            const interval = setInterval(() => {
                pos += speed;
                packet.style.left = pos + 'px';

                // Check if reached end (Container Width - Packet Size)
                if (pos >= (containerWidth - packetSize)) {
                    clearInterval(interval);
                    finishSync();
                }
            }, 10);
        }

        function finishSync() {
            const packet = document.getElementById('packet');
            packet.style.display = 'none';
            
            // Update Read DB
            readPrice = writePrice;
            document.getElementById('val-read').innerText = "$" + readPrice;
            
            // Visual Pulse for Read DB
            const dbRead = document.getElementById('db-read');
            dbRead.classList.remove('pulse');
            void dbRead.offsetWidth; 
            dbRead.classList.add('pulse');

            isSyncing = false;
            
            // Auto update customer view if they are watching? 
            // Ideally no, in web apps user must refresh, but let's notify status
            document.getElementById('msg-cust').innerText = "‚úÖ Database Synced.";
            document.getElementById('msg-cust').style.color = "#2ecc71";
        }

        function refreshPage() {
            // Customer reads ONLY from Read DB
            document.getElementById('cust-price').innerText = "$" + readPrice;
            
            const msg = document.getElementById('msg-cust');
            
            if (readPrice != writePrice) {
                // STALE DATA SCENARIO
                msg.innerText = "‚ö†Ô∏è STALE DATA! (Reading old value)";
                msg.style.color = "#f1c40f";
                shake(document.querySelector('.price-display'));
            } else {
                // FRESH DATA SCENARIO
                msg.innerText = "‚úÖ Fresh Data (Synced)";
                msg.style.color = "#2ecc71";
            }
        }

        function shake(el) {
            el.style.transform = "translateX(5px)";
            setTimeout(() => el.style.transform = "translateX(-5px)", 50);
            setTimeout(() => el.style.transform = "translateX(5px)", 100);
            setTimeout(() => el.style.transform = "translateX(0)", 150);
        }
    </script>
</body>
</html>




<!DOCTYPE html>
<html>
<head>
    <title>Sidecar Pattern Simulator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; align-items: center; margin-top: 60px; width: 800px; justify-content: center; position: relative; height: 300px; }
        
        /* CLIENT */
        .client-box { width: 120px; height: 80px; background: #34495e; border: 4px solid #2c3e50; display: flex; align-items: center; justify-content: center; font-weight: bold; position: absolute; left: 0; z-index: 10; border-radius: 8px; }

        /* THE POD (Container for Service + Sidecar) */
        .pod-container { 
            position: absolute; 
            right: 50px; 
            border: 3px dashed #7f8c8d; 
            padding: 20px; 
            border-radius: 15px; 
            display: flex; 
            gap: 10px; 
            background: rgba(255,255,255,0.05); 
            transition: all 0.5s;
        }
        .pod-label { position: absolute; top: -25px; left: 10px; color: #aaa; font-size: 12px; font-weight: bold; }

        /* MAIN APP (Motorcycle) */
        .main-app { 
            width: 160px; 
            height: 140px; 
            background: #e67e22; /* Orange */
            color: white; 
            border-radius: 8px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
            border: 4px solid #d35400;
            z-index: 5;
        }

        /* SIDECAR (The Attachment) */
        .sidecar { 
            width: 0; 
            height: 120px; 
            background: #27ae60; /* Green */
            border-radius: 0 8px 8px 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            opacity: 0;
            margin-top: 10px; /* Align slightly lower like a real sidecar */
            border: 0px solid #219150;
        }

        .sidecar.active { 
            width: 140px; 
            opacity: 1; 
            border: 4px solid #219150; 
            margin-left: -5px; /* Attach visual */
        }

        /* FEATURES ICONS */
        .feature-icon { font-size: 20px; margin: 2px; opacity: 0.5; }
        .feature-icon.active { opacity: 1; text-shadow: 0 0 10px white; }

        /* ANIMATION DOT */
        .dot { width: 16px; height: 16px; background: white; border-radius: 50%; position: absolute; z-index: 100; display: none; box-shadow: 0 0 10px white; }
        .dot.secure { background: #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .dot.unsecure { background: #e74c3c; box-shadow: 0 0 10px #e74c3c; }

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 50px; width: 600px; color: #333; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; margin: 0 10px; transition: 0.2s; color: white; }
        .btn-toggle { background: #34495e; }
        .btn-toggle:hover { background: #2c3e50; }
        .btn-req { background: #2980b9; }
        .btn-req:hover { background: #3498db; }

        /* LOGS */
        .log-container { display: flex; gap: 20px; margin-top: 20px; text-align: left; }
        .log-box { flex: 1; background: #eee; padding: 10px; border-radius: 5px; height: 100px; overflow-y: auto; font-family: monospace; font-size: 11px; border: 1px solid #ccc; }
        .log-title { font-weight: bold; margin-bottom: 5px; display: block; font-size: 12px; }

    </style>
</head>
<body>

    <h1>Sidecar Pattern Simulator</h1>
    <p>Offloading cross-cutting concerns (Logs, SSL) to a helper process.</p>

    <div class="layout">
        
        <div class="client-box" id="client">
            üë§ Client
        </div>

        <div class="pod-container" id="pod">
            <span class="pod-label">KUBERNETES POD / SERVER</span>
            
            <div class="sidecar" id="sidecar">
                <div style="font-weight:bold; margin-bottom:5px;">üõµ SIDECAR</div>
                <div style="font-size:10px;">(Proxy/Agent)</div>
                <div style="margin-top:10px;">
                    <span class="feature-icon" id="icon-ssl">üîí SSL</span><br>
                    <span class="feature-icon" id="icon-log">üìù LOG</span>
                </div>
            </div>

            <div class="main-app" id="main-app">
                <div style="font-size:30px;">üè¶</div>
                <div>LEGACY<br>TAX APP</div>
                <div style="font-size:10px; margin-top:5px; opacity:0.8;">(Old Python Code)</div>
            </div>

        </div>

    </div>

    <div id="dot" class="dot"></div>

    <div class="controls">
        <div style="margin-bottom: 20px;">
            <button class="btn-toggle" onclick="toggleSidecar()">üîÑ Toggle Sidecar Attachment</button>
            <button class="btn-req" onclick="sendRequest()">üöÄ Send Request</button>
        </div>

        <div class="log-container">
            <div class="log-box">
                <span class="log-title">üñ•Ô∏è MAIN APP LOGS (Business Logic)</span>
                <div id="log-app">Waiting...</div>
            </div>
            <div class="log-box">
                <span class="log-title">üõµ SIDECAR LOGS (Infrastructure)</span>
                <div id="log-sidecar" style="color:#777;">(Sidecar not attached)</div>
            </div>
        </div>
    </div>

    <script>
        let hasSidecar = false;

        function toggleSidecar() {
            hasSidecar = !hasSidecar;
            const sidecar = document.getElementById('sidecar');
            const pod = document.getElementById('pod');
            const logSidecar = document.getElementById('log-sidecar');

            if (hasSidecar) {
                sidecar.classList.add('active');
                // Move Pod container slightly to accommodate width change if needed, 
                // but flexbox handles it nicely.
                log("sidecar", "‚úÖ Sidecar Attached. Monitoring enabled.");
            } else {
                sidecar.classList.remove('active');
                logSidecar.innerHTML = "(Sidecar not attached)";
                log("app", "‚ö†Ô∏è Warning: Running unprotected.");
            }
        }

        function sendRequest() {
            const dot = document.getElementById('dot');
            const client = document.getElementById('client');
            const app = document.getElementById('main-app');
            const sidecar = document.getElementById('sidecar');

            // Reset visual logs
            document.getElementById('icon-ssl').classList.remove('active');
            document.getElementById('icon-log').classList.remove('active');

            // 1. Client -> Target
            // If Sidecar is there, we hit Sidecar first. If not, we hit App directly.
            const target = hasSidecar ? sidecar : app;
            
            // Visual feedback on dot color
            dot.className = hasSidecar ? 'dot secure' : 'dot unsecure';
            
            moveDot(client, target, () => {
                
                if (hasSidecar) {
                    // SIDECAR PROCESSING
                    log("sidecar", "üîí INBOUND: Decrypting SSL...");
                    document.getElementById('icon-ssl').classList.add('active');
                    
                    setTimeout(() => {
                        // Sidecar -> App
                        moveDot(sidecar, app, () => {
                            runAppLogic(() => {
                                // App -> Sidecar (Return trip)
                                moveDot(app, sidecar, () => {
                                    log("sidecar", "üìù OUTBOUND: Logging metrics (200 OK)");
                                    document.getElementById('icon-log').classList.add('active');
                                    
                                    // Sidecar -> Client
                                    moveDot(sidecar, client, () => {
                                        log("app", "--- Request Complete ---");
                                    });
                                });
                            });
                        });
                    }, 500);

                } else {
                    // NO SIDECAR PROCESSING
                    log("app", "‚ö†Ô∏è INBOUND: Request received (No SSL!).");
                    runAppLogic(() => {
                        // App -> Client
                        moveDot(app, client, () => {
                            log("app", "--- Request Complete (No Metrics) ---");
                        });
                    });
                }
            });
        }

        function runAppLogic(callback) {
            const app = document.getElementById('main-app');
            
            // Pulse App
            app.style.transform = "scale(1.1)";
            log("app", "‚öôÔ∏è EXEC: Calculating Taxes...");
            
            setTimeout(() => {
                app.style.transform = "scale(1)";
                callback();
            }, 800);
        }

        // --- ANIMATION UTILS ---
        function moveDot(fromEl, toEl, cb) {
            const dot = document.getElementById('dot');
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            dot.style.display = 'block';
            dot.style.top = (f.top + f.height/2 - 8) + 'px';
            dot.style.left = (f.left + f.width/2 - 8) + 'px';
            dot.style.transition = 'none';
            void dot.offsetWidth;

            dot.style.transition = 'all 0.5s ease-in-out';
            dot.style.top = (t.top + t.height/2 - 8) + 'px';
            dot.style.left = (t.left + t.width/2 - 8) + 'px';

            setTimeout(cb, 500);
        }

        function log(target, msg) {
            const el = document.getElementById(target === 'app' ? 'log-app' : 'log-sidecar');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            el.innerHTML = `[${time}] ${msg}<br>` + el.innerHTML;
        }

    </script>
</body>
</html>




<!DOCTYPE html>
<html>
<head>
    <title>API Composition Pattern Simulator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #2c3e50; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; flex-direction: column; align-items: center; margin-top: 40px; width: 800px; position: relative; height: 500px; }
        
        /* LAYERS */
        .layer-client { position: absolute; top: 0; width: 100%; display: flex; justify-content: center; }
        .layer-composer { position: absolute; top: 150px; width: 100%; display: flex; justify-content: center; }
        .layer-services { position: absolute; top: 350px; width: 100%; display: flex; justify-content: space-around; }

        /* BOXES */
        .box { border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; position: relative; transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        .client-box { width: 140px; height: 100px; background: #34495e; border: 4px solid #2c3e50; z-index: 10; }
        
        .composer-box { width: 200px; height: 120px; background: #e67e22; border: 4px solid #d35400; z-index: 8; }
        .composer-label { font-size: 14px; margin-bottom: 5px; }
        .composer-status { font-size: 11px; background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 4px; }

        .service-box { width: 140px; height: 100px; background: #27ae60; border: 4px solid #219150; z-index: 5; opacity: 0.8; }
        .service-name { margin-bottom: 5px; font-size: 13px; }
        .service-data { font-family: monospace; font-size: 10px; color: #cfc; display: none; }

        /* DATA PACKETS (DOTS) */
        .dot { width: 16px; height: 16px; border-radius: 50%; position: absolute; z-index: 100; display: none; box-shadow: 0 0 10px white; }
        .dot-req { background: #3498db; }  /* Request (Blue) */
        .dot-res { background: #f1c40f; }  /* Response (Yellow) */

        /* AGGREGATED DOCUMENT VISUAL */
        .doc-visual { position: absolute; width: 40px; height: 50px; background: white; border-radius: 4px; color: #333; font-size: 8px; padding: 2px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); display: none; z-index: 50; overflow: hidden; }
        .doc-part { width: 100%; height: 30%; margin-bottom: 2px; opacity: 0.5; }
        
        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 20px; width: 600px; color: #333; text-align: center; z-index: 20; }
        
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; background: #34495e; color: white; transition: 0.2s; font-size: 16px; }
        button:hover { background: #2c3e50; }

        .screen-display { background: #000; color: #0f0; font-family: monospace; padding: 10px; border-radius: 5px; margin-top: 15px; min-height: 60px; text-align: left; font-size: 12px; white-space: pre; }

    </style>
</head>
<body>

    <h1>API Composition Simulator</h1>
    <p>Aggregating scattered data into a unified response.</p>

    <div class="layout">
        
        <div class="layer-client">
            <div class="box client-box" id="client">
                <span>üì± Mobile App</span>
            </div>
        </div>

        <div class="layer-composer">
            <div class="box composer-box" id="composer">
                <span class="composer-label">üß© API COMPOSER</span>
                <span class="composer-status" id="comp-status">Idle</span>
            </div>
        </div>

        <div class="layer-services">
            <div class="box service-box" id="svc-user">
                <span class="service-name">üë§ User Svc</span>
                <span class="service-data">{"name":"John"}</span>
            </div>
            <div class="box service-box" id="svc-order">
                <span class="service-name">üì¶ Order Svc</span>
                <span class="service-data">{"last":"#9981"}</span>
            </div>
            <div class="box service-box" id="svc-wish">
                <span class="service-name">‚ù§Ô∏è Wishlist Svc</span>
                <span class="service-data">{"items":5}</span>
            </div>
        </div>

    </div>

    <div id="dot" class="dot"></div>
    <div id="doc-final" class="doc-visual">
        <div class="doc-part" style="background:#2980b9;"></div>
        <div class="doc-part" style="background:#27ae60;"></div>
        <div class="doc-part" style="background:#8e44ad;"></div>
    </div>

    <div class="controls">
        <button onclick="loadDashboard()">üöÄ Load Dashboard</button>
        <div class="screen-display" id="screen">Waiting for user...</div>
    </div>

    <script>
        function loadDashboard() {
            const screen = document.getElementById('screen');
            const status = document.getElementById('comp-status');
            
            // Reset
            screen.innerHTML = "Loading...";
            status.innerText = "Processing...";
            status.style.background = "#e67e22";

            // 1. Client -> Composer
            animatePacket('client', 'composer', 'dot-req', () => {
                
                status.innerText = "Fan-out Requests";
                
                // 2. Composer -> Services (PARALLEL)
                // We launch 3 animations simultaneously
                const p1 = new Promise(r => animatePacket('composer', 'svc-user', 'dot-req', r));
                const p2 = new Promise(r => animatePacket('composer', 'svc-order', 'dot-req', r));
                const p3 = new Promise(r => animatePacket('composer', 'svc-wish', 'dot-req', r));

                Promise.all([p1, p2, p3]).then(() => {
                    
                    // Services processing...
                    pulse('svc-user');
                    pulse('svc-order');
                    pulse('svc-wish');

                    setTimeout(() => {
                        // 3. Services -> Composer (Responses)
                        const r1 = new Promise(r => animatePacket('svc-user', 'composer', 'dot-res', r));
                        const r2 = new Promise(r => animatePacket('svc-order', 'composer', 'dot-res', r));
                        const r3 = new Promise(r => animatePacket('svc-wish', 'composer', 'dot-res', r));

                        Promise.all([r1, r2, r3]).then(() => {
                            
                            // Aggregation Logic
                            status.innerText = "Stitching Data...";
                            status.style.background = "#27ae60"; // Green
                            pulse('composer');

                            setTimeout(() => {
                                // 4. Composer -> Client (Final Document)
                                animateDoc('composer', 'client', () => {
                                    status.innerText = "Idle";
                                    status.style.background = "rgba(0,0,0,0.2)";
                                    
                                    screen.innerHTML = `
HTTP/1.1 200 OK
{
  "user": { "name": "John Doe" },   <span style="color:#2980b9">// From User Svc</span>
  "order": { "last": "#9981" },     <span style="color:#27ae60">// From Order Svc</span>
  "wishlist": { "count": 5 }        <span style="color:#8e44ad">// From Wishlist Svc</span>
}`;
                                });
                            }, 500);
                        });
                    }, 400); // Processing delay
                });
            });
        }

        // --- ANIMATION UTILS ---
        function animatePacket(fromId, toId, dotClass, callback) {
            // Create a dedicated dot for parallel animations
            const dot = document.createElement('div');
            dot.className = `dot ${dotClass}`;
            document.body.appendChild(dot);

            const fromEl = document.getElementById(fromId);
            const toEl = document.getElementById(toId);
            
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            dot.style.display = 'block';
            dot.style.top = (f.top + f.height/2 - 8) + 'px';
            dot.style.left = (f.left + f.width/2 - 8) + 'px';
            
            // Force reflow
            void dot.offsetWidth;

            dot.style.transition = 'all 0.6s ease-in-out';
            dot.style.top = (t.top + t.height/2 - 8) + 'px';
            dot.style.left = (t.left + t.width/2 - 8) + 'px';

            setTimeout(() => {
                dot.remove();
                if(callback) callback();
            }, 600);
        }

        function animateDoc(fromId, toId, callback) {
            const doc = document.getElementById('doc-final');
            const fromEl = document.getElementById(fromId);
            const toEl = document.getElementById(toId);
            
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            doc.style.display = 'block';
            doc.style.top = (f.top + f.height/2 - 25) + 'px';
            doc.style.left = (f.left + f.width/2 - 20) + 'px';
            doc.style.transition = 'all 0.8s ease-in-out';
            
            setTimeout(() => {
                doc.style.top = (t.top + t.height/2 - 25) + 'px';
                doc.style.left = (t.left + t.width/2 - 20) + 'px';
                
                setTimeout(() => {
                    doc.style.display = 'none';
                    if(callback) callback();
                }, 800);
            }, 50);
        }

        function pulse(id) {
            const el = document.getElementById(id);
            el.style.transform = "scale(1.1)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }
    </script>
</body>
</html>









<!DOCTYPE html>
<html>
<head>
    <title>Event-Driven Architecture Simulator</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #1e1e2e; display: flex; flex-direction: column; align-items: center; padding: 20px; color: white; }
        
        .layout { display: flex; flex-direction: column; align-items: center; margin-top: 40px; width: 900px; position: relative; height: 500px; }
        
        /* PRODUCER (Top) */
        .producer-zone { width: 100%; display: flex; justify-content: center; margin-bottom: 40px; }
        .producer-box { width: 160px; height: 100px; background: #3498db; border: 4px solid #2980b9; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; position: relative; z-index: 10; box-shadow: 0 0 20px rgba(52, 152, 219, 0.4); }

        /* EVENT BUS (Middle) */
        .bus-zone { width: 100%; height: 60px; background: #333; border-radius: 30px; border: 2px dashed #666; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 60px; }
        .bus-label { background: #1e1e2e; padding: 0 10px; color: #888; font-weight: bold; letter-spacing: 2px; }

        /* CONSUMERS (Bottom) */
        .consumer-zone { width: 100%; display: flex; justify-content: space-around; }
        .consumer-box { width: 140px; height: 100px; background: #2c3e50; border: 2px solid #444; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; position: relative; transition: all 0.2s; }
        .consumer-box.active { background: #2ecc71; border-color: #27ae60; transform: scale(1.1); box-shadow: 0 0 15px #2ecc71; }
        
        .status-text { font-size: 10px; margin-top: 5px; opacity: 0.7; font-family: monospace; }

        /* PIPES */
        .pipe-down { position: absolute; width: 4px; background: #555; z-index: 0; }

        /* EVENT PACKETS */
        .packet { width: 20px; height: 20px; background: #f1c40f; border-radius: 50%; position: absolute; z-index: 100; display: none; box-shadow: 0 0 10px #f1c40f; border: 2px solid white; }

        /* CONTROLS */
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 20px; width: 600px; color: #333; text-align: center; }
        button { padding: 12px 25px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; background: #3498db; color: white; transition: 0.2s; font-size: 16px; }
        button:hover { background: #2980b9; }

        .log-display { font-family: monospace; background: #eee; padding: 10px; margin-top: 15px; border-radius: 5px; min-height: 80px; text-align: left; font-size: 12px; max-height: 100px; overflow-y: auto; color: #333; }

    </style>
</head>
<body>

    <h1>Event-Driven Architecture Simulator</h1>
    <p>Decoupling: One event triggers multiple, independent actions.</p>

    <div class="layout">
        
        <div class="producer-zone">
            <div class="producer-box" id="producer">
                <div style="font-size:30px;">üë§</div>
                <div>User Service</div>
                <div style="font-size:10px;">(Publisher)</div>
            </div>
        </div>

        <div class="pipe-down" style="top: 100px; height: 40px; left: 50%; transform: translateX(-50%);"></div>

        <div class="bus-zone" id="bus">
            <span class="bus-label">‚ö° EVENT BUS / TOPIC ‚ö°</span>
        </div>

        <div class="consumer-zone">
            
            <div class="consumer-box" id="sub-email">
                <div style="font-size:24px;">üìß</div>
                <div>Email Svc</div>
                <div class="status-text" id="log-email">Listening...</div>
                <div class="pipe-down" style="top: -60px; height: 60px; left: 50%; transform: translateX(-50%);"></div>
            </div>

            <div class="consumer-box" id="sub-analytics">
                <div style="font-size:24px;">üìä</div>
                <div>Analytics Svc</div>
                <div class="status-text" id="log-analytics">Listening...</div>
                <div class="pipe-down" style="top: -60px; height: 60px; left: 50%; transform: translateX(-50%);"></div>
            </div>

            <div class="consumer-box" id="sub-fraud">
                <div style="font-size:24px;">üõ°Ô∏è</div>
                <div>Fraud Svc</div>
                <div class="status-text" id="log-fraud">Listening...</div>
                <div class="pipe-down" style="top: -60px; height: 60px; left: 50%; transform: translateX(-50%);"></div>
            </div>

        </div>

    </div>

    <div id="packet" class="packet"></div>

    <div class="controls">
        <button onclick="publishEvent()">üì¢ User Signed Up!</button>
        <div class="log-display" id="main-log">Waiting for events...</div>
    </div>

    <script>
        function publishEvent() {
            // Reset visuals
            resetConsumers();
            log("--- New Sequence ---");
            log("üì¢ User Service: Publishing 'USER_REGISTERED' event...");

            const producer = document.getElementById('producer');
            const bus = document.getElementById('bus');
            
            // Pulse Producer
            producer.style.transform = "scale(1.1)";
            setTimeout(() => producer.style.transform = "scale(1)", 200);

            // 1. Animate to Bus
            animatePacket(producer, bus, () => {
                
                log("‚ö° Bus: Broadcasting event to 3 subscribers...");
                
                // 2. Fan-out to Subscribers (Parallel)
                const subs = ['sub-email', 'sub-analytics', 'sub-fraud'];
                
                subs.forEach((subId, index) => {
                    const subEl = document.getElementById(subId);
                    
                    // Create individual packets for fan-out
                    const p = document.createElement('div');
                    p.className = 'packet';
                    p.style.display = 'block';
                    document.body.appendChild(p);
                    
                    // Delay slightly for visual effect
                    setTimeout(() => {
                        animateCustomPacket(p, bus, subEl, () => {
                            p.remove();
                            activateConsumer(subId);
                        });
                    }, index * 100);
                });

            });
        }

        function activateConsumer(id) {
            const el = document.getElementById(id);
            const status = document.getElementById(id.replace('sub', 'log'));
            
            el.classList.add('active');
            
            // Specific logic logs
            if (id === 'sub-email') {
                status.innerText = "Email Sent!";
                log("üìß Email Svc: Sent welcome email.");
            } else if (id === 'sub-analytics') {
                status.innerText = "Count +1";
                log("üìä Analytics: Incremented daily signups.");
            } else if (id === 'sub-fraud') {
                status.innerText = "Scan OK";
                log("üõ°Ô∏è Fraud Svc: User marked safe.");
            }

            setTimeout(() => {
                el.classList.remove('active');
                status.innerText = "Listening...";
            }, 1500);
        }

        function resetConsumers() {
            document.querySelectorAll('.consumer-box').forEach(el => el.classList.remove('active'));
        }

        // --- ANIMATION UTILS ---
        function animatePacket(fromEl, toEl, callback) {
            const pkt = document.getElementById('packet');
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            pkt.style.display = 'block';
            pkt.style.top = (f.bottom - 10) + 'px';
            pkt.style.left = (f.left + f.width/2 - 10) + 'px';
            
            pkt.offsetHeight; // force reflow

            pkt.style.transition = 'all 0.5s ease-in';
            pkt.style.top = (t.top + t.height/2 - 10) + 'px';
            pkt.style.left = (t.left + t.width/2 - 10) + 'px';

            setTimeout(() => {
                pkt.style.display = 'none';
                pkt.style.transition = 'none';
                if(callback) callback();
            }, 500);
        }

        function animateCustomPacket(pkt, fromEl, toEl, callback) {
            const f = fromEl.getBoundingClientRect();
            const t = toEl.getBoundingClientRect();

            pkt.style.top = (f.top + f.height/2 - 10) + 'px';
            pkt.style.left = (f.left + f.width/2 - 10) + 'px';
            
            pkt.offsetHeight;

            pkt.style.transition = 'all 0.5s ease-out';
            pkt.style.top = (t.top) + 'px';
            pkt.style.left = (t.left + t.width/2 - 10) + 'px';

            setTimeout(callback, 500);
        }

        function log(msg) {
            const box = document.getElementById('main-log');
            box.innerHTML = `> ${msg}<br>` + box.innerHTML;
        }

    </script>
</body>
</html>
